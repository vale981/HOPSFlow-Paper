#+PROPERTY: header-args :session otto_baseline :kernel python :pandoc no :async yes :tangle otto_baseline.py

* Boilerplate
#+name: boilerplate
#+begin_src jupyter-python :results none
    import figsaver as fs
    import plot_utils as pu
    from hiro_models.one_qubit_model import StocProcTolerances
    from hiro_models.otto_cycle import OttoEngine
    import hiro_models.model_auxiliary as aux
    import numpy as np
    import qutip as qt
    import utilities as ut
    import stocproc
    import matplotlib.pyplot as plt
    import otto_utilities as ot

    import ray
    ray.shutdown()

    #ray.init(address='auto')
    ray.init()
    from hops.util.logging_setup import logging_setup
    import logging
    logging_setup(logging.INFO)
    plt.rcParams['figure.figsize'] = (12,4)
#+end_src

* Model: Baseline
:PROPERTIES:
:header-args: :tangle baseline.py :session baseline :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[1, 1],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle that actually works.",
      k_max=4,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "fft"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=((0.6, 0.7, 0.9, 1), (0.1, 0.2, 0.4, 0.5)),
      streaming_mode=True,
  )
#+end_src


#+begin_src jupyter-python :tangle no
  ot.plot_cycle(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/87751560c860ffc158656668d6eed3af3aad0106.svg]]
:END:


#+begin_src jupyter-python :tangle no
  ot.integrate_online(model, 5000)
#+end_src

#+RESULTS:
:RESULTS:
#+begin_example
  [INFO    hops.core.integration     9141] Choosing the nonlinear integrator.
  [INFO    root                      9141] Starting analysis process.
  [INFO    root                      9141] Started analysis process with pid 53939.
  [INFO    hops.core.hierarchy_data  9141] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_b28fda1ae09e50be64694fbb2886a0c43f329c2036a918a72db2346af5779470.fifo
  [INFO    hops.core.integration     9141] Using 16 integrators.
  [INFO    hops.core.integration     9141] Some 1333 trajectories have to be integrated.
  [INFO    hops.core.integration     9141] Using 1820 hierarchy states.
   38% 510/1333 [20:30<33:05,  2.41s/it][INFO    hops.core.signal_delay    9141] caught sig 'SIGINT'
   38% 511/1333 [20:36<33:09,  2.42s/it]
  [INFO    hops.core.signal_delay    9141] caught 1 signal(s)
  [INFO    hops.core.signal_delay    9141] emit signal 'SIGINT'
  [INFO    hops.core.signal_delay    9141] caught sig 'SIGINT'
  2022-12-05 13:55:39,840       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,860       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,861       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,862       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,862       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,863       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,864       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,864       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,865       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,866       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,866       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,868       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,868       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,869       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,871       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-05 13:55:39,871       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
#+end_example
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mBeartypeCallHintParamViolation[0m            Traceback (most recent call last)
  Cell [0;32mIn[8], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mintegrate_online[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[38;5;241;43m5000[39;49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:103[0m, in [0;36mintegrate_online[0;34m(model, n)[0m
  [1;32m    102[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online[39m(model, n):
  [0;32m--> 103[0m     [43maux[49m[38;5;241;43m.[39;49m[43mintegrate[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[43mn[49m[43m,[49m[43m [49m[43mstream_file[49m[38;5;241;43m=[39;49m[38;5;124;43mf[39;49m[38;5;124;43m"[39;49m[38;5;124;43mresults_[39;49m[38;5;132;43;01m{[39;49;00m[43mmodel[49m[38;5;241;43m.[39;49m[43mhexhash[49m[38;5;132;43;01m}[39;49;00m[38;5;124;43m.fifo[39;49m[38;5;124;43m"[39;49m[43m,[49m[43m [49m[43manalyze[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m)[49m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:199[0m, in [0;36mintegrate[0;34m(model, n, data_path, clear_pd, single_process, stream_file, analyze, results_path, analyze_kwargs)[0m
  [1;32m    197[0m         supervisor[38;5;241m.[39mintegrate_single_process(clear_pd)
  [1;32m    198[0m     [38;5;28;01melse[39;00m:
  [0;32m--> 199[0m         supervisor[38;5;241m.[39mintegrate(clear_pd)
  [1;32m    201[0m cleanup([38;5;241m0[39m)

  File [0;32m~/src/hops/hops/core/signal_delay.py:85[0m, in [0;36msig_delay.__exit__[0;34m(self, exc_type, exc_val, exc_tb)[0m
  [1;32m     83[0m log[38;5;241m.[39mdebug([38;5;124m"[39m[38;5;124msignal_delay context left![39m[38;5;124m"[39m)
  [1;32m     84[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught) [38;5;241m>[39m [38;5;241m0[39m [38;5;129;01mand[39;00m [38;5;28mself[39m[38;5;241m.[39mhandler [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
  [0;32m---> 85[0m     [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mhandler[49m[43m([49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43msigh[49m[38;5;241;43m.[39;49m[43msigs_caught[49m[43m)[49m
  [1;32m     87[0m [38;5;28mself[39m[38;5;241m.[39m_restore()

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:175[0m, in [0;36mintegrate.<locals>.cleanup[0;34m(***failed resolving arguments***)[0m
  [1;32m    172[0m     analysis_process[38;5;241m.[39mjoin()
  [1;32m    174[0m [38;5;28;01mwith[39;00m supervisor[38;5;241m.[39mget_data([38;5;28;01mTrue[39;00m, stream[38;5;241m=[39m[38;5;28;01mFalse[39;00m) [38;5;28;01mas[39;00m data:
  [0;32m--> 175[0m     [38;5;28;01mwith[39;00m model_db(data_path) [38;5;28;01mas[39;00m db:
  [1;32m    176[0m         dct [38;5;241m=[39m {
  [1;32m    177[0m             [38;5;124m"[39m[38;5;124mmodel_config[39m[38;5;124m"[39m: model[38;5;241m.[39mto_dict(),
  [1;32m    178[0m             [38;5;124m"[39m[38;5;124mdata_path[39m[38;5;124m"[39m: [38;5;28mstr[39m(Path(data[38;5;241m.[39mhdf5_name)[38;5;241m.[39mrelative_to(data_path)),
  [1;32m    179[0m         }
  [1;32m    181[0m         [38;5;28;01mif[39;00m analysis_process:

  File [0;32m/nix/store/nwpv33bscqyf1d9janfjhw1k716r7fd4-python3-3.9.15/lib/python3.9/contextlib.py:119[0m, in [0;36m_GeneratorContextManager.__enter__[0;34m(self)[0m
  [1;32m    117[0m [38;5;28;01mdel[39;00m [38;5;28mself[39m[38;5;241m.[39margs, [38;5;28mself[39m[38;5;241m.[39mkwds, [38;5;28mself[39m[38;5;241m.[39mfunc
  [1;32m    118[0m [38;5;28;01mtry[39;00m:
  [0;32m--> 119[0m     [38;5;28;01mreturn[39;00m [38;5;28;43mnext[39;49m[43m([49m[38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43mgen[49m[43m)[49m
  [1;32m    120[0m [38;5;28;01mexcept[39;00m [38;5;167;01mStopIteration[39;00m:
  [1;32m    121[0m     [38;5;28;01mraise[39;00m [38;5;167;01mRuntimeError[39;00m([38;5;124m"[39m[38;5;124mgenerator didn[39m[38;5;124m'[39m[38;5;124mt yield[39m[38;5;124m"[39m) [38;5;28;01mfrom[39;00m [38;5;28mNone[39m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:49[0m, in [0;36mmodel_db[0;34m(data_path)[0m
  [1;32m     47[0m data [38;5;241m=[39m f[38;5;241m.[39mread()
  [1;32m     48[0m db [38;5;241m=[39m JSONEncoder[38;5;241m.[39mloads(data) [38;5;28;01mif[39;00m [38;5;28mlen[39m(data) [38;5;241m>[39m [38;5;241m0[39m [38;5;28;01melse[39;00m {}
  [0;32m---> 49[0m db [38;5;241m=[39m {
  [1;32m     50[0m     key: model_hook(value) [38;5;28;01mif[39;00m [38;5;28misinstance[39m(value, [38;5;28mdict[39m) [38;5;28;01melse[39;00m value
  [1;32m     51[0m     [38;5;28;01mfor[39;00m key, value [38;5;129;01min[39;00m db[38;5;241m.[39mitems()
  [1;32m     52[0m }
  [1;32m     54[0m [38;5;28;01myield[39;00m db
  [1;32m     56[0m f[38;5;241m.[39mtruncate([38;5;241m0[39m)

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:50[0m, in [0;36m<dictcomp>[0;34m(.0)[0m
  [1;32m     47[0m data [38;5;241m=[39m f[38;5;241m.[39mread()
  [1;32m     48[0m db [38;5;241m=[39m JSONEncoder[38;5;241m.[39mloads(data) [38;5;28;01mif[39;00m [38;5;28mlen[39m(data) [38;5;241m>[39m [38;5;241m0[39m [38;5;28;01melse[39;00m {}
  [1;32m     49[0m db [38;5;241m=[39m {
  [0;32m---> 50[0m     key: [43mmodel_hook[49m[43m([49m[43mvalue[49m[43m)[49m [38;5;28;01mif[39;00m [38;5;28misinstance[39m(value, [38;5;28mdict[39m) [38;5;28;01melse[39;00m value
  [1;32m     51[0m     [38;5;28;01mfor[39;00m key, value [38;5;129;01min[39;00m db[38;5;241m.[39mitems()
  [1;32m     52[0m }
  [1;32m     54[0m [38;5;28;01myield[39;00m db
  [1;32m     56[0m f[38;5;241m.[39mtruncate([38;5;241m0[39m)

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:85[0m, in [0;36mmodel_hook[0;34m(dct)[0m
  [1;32m     83[0m [38;5;28;01mfor[39;00m key, value [38;5;129;01min[39;00m dct[38;5;241m.[39mitems():
  [1;32m     84[0m     [38;5;28;01mif[39;00m [38;5;28misinstance[39m(value, [38;5;28mdict[39m):
  [0;32m---> 85[0m         dct[key] [38;5;241m=[39m [43mmodel_hook[49m[43m([49m[43mvalue[49m[43m)[49m
  [1;32m     87[0m [38;5;28;01mreturn[39;00m dct

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:81[0m, in [0;36mmodel_hook[0;34m(dct)[0m
  [1;32m     78[0m         [38;5;28;01mreturn[39;00m QubitModelMutliBath[38;5;241m.[39mfrom_dict(treated_vals)
  [1;32m     80[0m     [38;5;28;01mif[39;00m model [38;5;241m==[39m [38;5;124m"[39m[38;5;124mOttoEngine[39m[38;5;124m"[39m:
  [0;32m---> 81[0m         [38;5;28;01mreturn[39;00m [43mOttoEngine[49m[38;5;241;43m.[39;49m[43mfrom_dict[49m[43m([49m[43mtreated_vals[49m[43m)[49m
  [1;32m     83[0m [38;5;28;01mfor[39;00m key, value [38;5;129;01min[39;00m dct[38;5;241m.[39mitems():
  [1;32m     84[0m     [38;5;28;01mif[39;00m [38;5;28misinstance[39m(value, [38;5;28mdict[39m):

  File [0;32m~/src/two_qubit_model/hiro_models/model_base.py:132[0m, in [0;36mModel.from_dict[0;34m(cls, model_dict)[0m
  [1;32m    129[0m [38;5;28;01mdel[39;00m model_dict[[38;5;124m"[39m[38;5;124m__base_version__[39m[38;5;124m"[39m]
  [1;32m    130[0m [38;5;28;01mdel[39;00m model_dict[[38;5;124m"[39m[38;5;124m__model__[39m[38;5;124m"[39m]
  [0;32m--> 132[0m [38;5;28;01mreturn[39;00m [38;5;28;43mcls[39;49m[43m([49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mmodel_dict[49m[43m)[49m

  File [0;32m<@beartype(hiro_models.otto_cycle.__create_fn__.__init__) at 0x7fcc227e24c0>:340[0m, in [0;36m__init__[0;34m(__beartype_func, __beartype_conf, __beartype_get_violation, __beartype_object_53251328, __beartype_object_140513182631296, __beartype_object_140515230442784, __beartype_object_140515230439008, __beartype_object_140515404495776, __beartype_getrandbits, __beartype_object_14381104, __beartype_object_52885584, __beartype_object_50143248, __beartype_object_140514728879040, __beartype_object_140515433764192, *args, **kwargs)[0m

  [0;31mBeartypeCallHintParamViolation[0m: @beartyped hiro_models.otto_cycle.__create_fn__.__init__() parameter L=[array([[0. +0.j, 0.5+0.j],
         [0.5+0.j, 0. +0.j]]), array([[0. +0.j, 0.5+0.j],
         [...+ violates type hint tuple[numpy.ndarray, numpy.ndarray], as list [array([[0. +0.j, 0.5+0.j],
         [0.5+0.j, 0. +0.j]]), array([[0. +0.j, 0.5+0.j],
         [...+ not instance of tuple.
#+end_example
:END:

** Results
:PROPERTIES:
:header-args:  :session baseline_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
    import otto_utilities as ot
    from baseline import model

    ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Energy | > |
[[file:./.ob-jupyter/5982fa67640b7b68288cc339c98ac5bd482c47b1.svg]]
:END:



#+begin_src jupyter-python
  model.efficiency(), model.power()
#+end_src

#+RESULTS:
| EnsembleValue | (((5000 0.3010165917009053 0.0048918154339318435))) | EnsembleValue | (((5000 -0.002944840403631359 2.9017372583677964e-05))) |


#+begin_src jupyter-python
    ot.full_report(model)
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/d60576d851410d3314c87dc6f8e9fd29db810a9b.svg]]
:RESULTS:
: \(P=-0.002945\pm 0.000029\)
: \(\eta=30.1\pm 0.5\)
[[file:./.ob-jupyter/4e36c804ebab8d355bc41df70b67a28e5cb93182.svg]]
[[file:./.ob-jupyter/e3b17f977164a9ddb1a20ecd733087a56696857e.svg]]
:END:

* Model: Baseline, continously coupled
:PROPERTIES:
:header-args: :tangle baseline_cc.py :session baseline_cc :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output without coupling modulation.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[1, 1],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle that actually works.",
      k_max=4,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "fft"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=(None, None),
      streaming_mode=True,
  )

  ot.plot_cycle(model)
#+end_src


#+begin_src jupyter-python
  ot.integrate_online(model, 5000)
#+end_src

** Results
:PROPERTIES:
:header-args:  :session baseline_cc_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
    import otto_utilities as ot
    from baseline_cc import model

    ot.plot_energy(model)
#+end_src


#+begin_src jupyter-python
  model.efficiency(), model.power()
#+end_src


#+begin_src jupyter-python
    ot.full_report(model)
#+end_src
:RESULTS:
: \(P=-0.000488\pm 0.000021\)
: \(\eta=1.32\pm 0.06\)
[[file:./.ob-jupyter/5d6803828c5f069e1abeeca5906cf627ec1a0720.svg]]
[[file:./.ob-jupyter/d0ac6d4dccf574add7cb85f8a9a8e302e8e13e1a.svg]]
:END:

* Model: Baseline Without Resonance
:PROPERTIES:
:header-args: :tangle baseline_noshift.py :session baseline_noshift :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output but without resonance.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[2, 2],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle without the shift.",
      k_max=3,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "tanhsinh"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=((0.6, 0.7, 0.9, 1), (0.1, 0.2, 0.4, 0.5)),
      streaming_mode=True,
      shift_to_resonance=(False, False)
  )

  ot.plot_cycle(model)
#+end_src
#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/f20bd31f314971d151bc7670a12df84531cf08e5.svg]]
:END:


#+begin_src jupyter-python
  ot.plot_sd_overview(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\omega$ | ylabel= | Spectral Density | > |
[[file:./.ob-jupyter/6e23dbc00f1a3114d0302196fd6650b3b628c38e.svg]]
:END:


#+begin_src jupyter-python :tangle integrate
  ot.integrate_online(model, 500)
#+end_src

#+RESULTS:
: [INFO    hops.core.integration     67618] Choosing the nonlinear integrator.
: [INFO    root                      67618] Starting analysis process.
: [INFO    root                      67618] Started analysis process with pid 68727.
: [INFO    hops.core.hierarchy_data  67618] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_265bfe35dbf31564d0c4034a8ed74e7b3a9c6f38bfc9b356164a7e56e0689d0f.fifo
: [INFO    hops.core.integration     67618] Using 16 integrators.
: [INFO    hops.core.integration     67618] Some 400 trajectories have to be integrated.
: [INFO    hops.core.integration     67618] Using 165 hierarchy states.
: 100% 400/400 [06:09<00:00,  1.08it/s]

** Results
:PROPERTIES:
:header-args:  :session baseline_noshift_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
    import otto_utilities as ot
    from baseline_noshift import model

    ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Energy | > |
[[file:./.ob-jupyter/fe150cb2bdc2b283a7adc5afa3e992faf24b6799.svg]]
:END:


#+begin_src jupyter-python
    model.efficiency(), model.power()
#+end_src

#+RESULTS:
| EnsembleValue | (((100 nan nan))) | EnsembleValue | (((100 nan nan))) |

#+begin_src jupyter-python
    ot.full_report(model)
#+end_src

#+RESULTS:
:RESULTS:
[[file:./.ob-jupyter/85cf6625457669c87daa061903c80468863c5c18.svg]]
[[file:./.ob-jupyter/2da817963fba328d9cf1e5ae8d525460d6883072.svg]]
:END:
:RESULTS:
: \(P=-0.002388\pm 0.000038\)
: \(\eta=28.0\pm 0.6\)
[[file:./.ob-jupyter/24fdd0953097e9c3b1f525228fe15d95ee52cf99.svg]]
[[file:./.ob-jupyter/94caa78e07e05758046236248e3527c95dd8d79c.svg]]
[[file:./.ob-jupyter/2cc5de8d17157cfaca597faf7ed8949ddf6d9b75.svg]]
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mOverflowError[0m                             Traceback (most recent call last)
  Cell [0;32mIn[3], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mfull_report[49m[43m([49m[43mmodel[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:81[0m, in [0;36mfull_report[0;34m(model)[0m
  [1;32m     77[0m power [38;5;241m=[39m model[38;5;241m.[39mpower()
  [1;32m     78[0m Î· [38;5;241m=[39m model[38;5;241m.[39mefficiency() [38;5;241m*[39m [38;5;241m100[39m
  [1;32m     80[0m [38;5;28mprint[39m(
  [0;32m---> 81[0m     [43mfs[49m[38;5;241;43m.[39;49m[43mtex_value[49m[43m([49m[43mpower[49m[38;5;241;43m.[39;49m[43mvalue[49m[43m,[49m[43m [49m[43merr[49m[38;5;241;43m=[39;49m[43mpower[49m[38;5;241;43m.[39;49m[43mÏƒ[49m[43m,[49m[43m [49m[43mprefix[49m[38;5;241;43m=[39;49m[38;5;124;43m"[39;49m[38;5;124;43mP=[39;49m[38;5;124;43m"[39;49m[43m)[49m,
  [1;32m     82[0m )
  [1;32m     83[0m [38;5;28mprint[39m(
  [1;32m     84[0m     fs[38;5;241m.[39mtex_value(Î·[38;5;241m.[39mvalue, err[38;5;241m=[39mÎ·[38;5;241m.[39mÏƒ, prefix[38;5;241m=[39m[38;5;124mr[39m[38;5;124m"[39m[38;5;124m\[39m[38;5;124meta=[39m[38;5;124m"[39m),
  [1;32m     85[0m )

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:100[0m, in [0;36mtex_value[0;34m(val, err, unit, prefix, suffix, prec, save)[0m
  [1;32m     97[0m [38;5;124;03m"""Generates LaTeX output of a value with units and error."""[39;00m
  [1;32m     99[0m [38;5;28;01mif[39;00m err:
  [0;32m--> 100[0m     val, err, prec [38;5;241m=[39m [43mscientific_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43merr[49m[43m,[49m[43m [49m[43mretprec[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m)[49m
  [1;32m    101[0m [38;5;28;01melse[39;00m:
  [1;32m    102[0m     val [38;5;241m=[39m np[38;5;241m.[39mround(val, prec)

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:91[0m, in [0;36mscientific_round[0;34m(val, retprec, *err)[0m
  [1;32m     89[0m prec [38;5;241m=[39m prec[[38;5;241m0[39m]
  [1;32m     90[0m [38;5;28;01mif[39;00m retprec:
  [0;32m---> 91[0m     [38;5;28;01mreturn[39;00m ([43msmart_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43mprec[49m[43m)[49m, [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m], prec)
  [1;32m     92[0m [38;5;28;01melse[39;00m:
  [1;32m     93[0m     [38;5;28;01mreturn[39;00m (smart_round(val, prec), [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m])

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:71[0m, in [0;36mscientific_round.<locals>.smart_round[0;34m(value, precision)[0m
  [1;32m     70[0m [38;5;28;01mdef[39;00m [38;5;21msmart_round[39m(value, precision):
  [0;32m---> 71[0m     value [38;5;241m=[39m [43mnp[49m[38;5;241;43m.[39;49m[43mround[49m[43m([49m[43mvalue[49m[43m,[49m[43m [49m[43mprecision[49m[43m)[49m
  [1;32m     72[0m     [38;5;28;01mif[39;00m precision [38;5;241m<[39m[38;5;241m=[39m [38;5;241m0[39m:
  [1;32m     73[0m         value [38;5;241m=[39m value[38;5;241m.[39mastype([38;5;28mint[39m)

  File [0;32m<__array_function__ internals>:180[0m, in [0;36mround_[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3731[0m, in [0;36mround_[0;34m(a, decimals, out)[0m
  [1;32m   3722[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3723[0m [38;5;28;01mdef[39;00m [38;5;21mround_[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3724[0m     [38;5;124;03m"""[39;00m
  [1;32m   3725[0m [38;5;124;03m    Round an array to the given number of decimals.[39;00m
  [1;32m   3726[0m
  [0;32m   (...)[0m
  [1;32m   3729[0m [38;5;124;03m    around : equivalent function; see for details.[39;00m
  [1;32m   3730[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3731[0m     [38;5;28;01mreturn[39;00m [43maround[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m<__array_function__ internals>:180[0m, in [0;36maround[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3305[0m, in [0;36maround[0;34m(a, decimals, out)[0m
  [1;32m   3214[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3215[0m [38;5;28;01mdef[39;00m [38;5;21maround[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3216[0m     [38;5;124;03m"""[39;00m
  [1;32m   3217[0m [38;5;124;03m    Evenly round to the given number of decimals.[39;00m
  [1;32m   3218[0m
  [0;32m   (...)[0m
  [1;32m   3303[0m
  [1;32m   3304[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3305[0m     [38;5;28;01mreturn[39;00m [43m_wrapfunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mround[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:57[0m, in [0;36m_wrapfunc[0;34m(obj, method, *args, **kwds)[0m
  [1;32m     54[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)
  [1;32m     56[0m [38;5;28;01mtry[39;00m:
  [0;32m---> 57[0m     [38;5;28;01mreturn[39;00m [43mbound[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
  [1;32m     58[0m [38;5;28;01mexcept[39;00m [38;5;167;01mTypeError[39;00m:
  [1;32m     59[0m     [38;5;66;03m# A TypeError occurs if the object does have such a method in its[39;00m
  [1;32m     60[0m     [38;5;66;03m# class, but its signature is not identical to that of NumPy's. This[39;00m
  [0;32m   (...)[0m
  [1;32m     64[0m     [38;5;66;03m# Call _wrapit from within the except clause to ensure a potential[39;00m
  [1;32m     65[0m     [38;5;66;03m# exception has a traceback chain.[39;00m
  [1;32m     66[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)

  [0;31mOverflowError[0m: signed integer is less than minimum
#+end_example
[[file:./.ob-jupyter/110fb9b41690c93c993cb682424235d36f7d4db1.svg]]
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mOverflowError[0m                             Traceback (most recent call last)
  Cell [0;32mIn[6], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mfull_report[49m[43m([49m[43mmodel[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:81[0m, in [0;36mfull_report[0;34m(model)[0m
  [1;32m     77[0m power [38;5;241m=[39m model[38;5;241m.[39mpower()
  [1;32m     78[0m Î· [38;5;241m=[39m model[38;5;241m.[39mefficiency() [38;5;241m*[39m [38;5;241m100[39m
  [1;32m     80[0m [38;5;28mprint[39m(
  [0;32m---> 81[0m     [43mfs[49m[38;5;241;43m.[39;49m[43mtex_value[49m[43m([49m[43mpower[49m[38;5;241;43m.[39;49m[43mvalue[49m[43m,[49m[43m [49m[43merr[49m[38;5;241;43m=[39;49m[43mpower[49m[38;5;241;43m.[39;49m[43mÏƒ[49m[43m,[49m[43m [49m[43mprefix[49m[38;5;241;43m=[39;49m[38;5;124;43m"[39;49m[38;5;124;43mP=[39;49m[38;5;124;43m"[39;49m[43m)[49m,
  [1;32m     82[0m )
  [1;32m     83[0m [38;5;28mprint[39m(
  [1;32m     84[0m     fs[38;5;241m.[39mtex_value(Î·[38;5;241m.[39mvalue, err[38;5;241m=[39mÎ·[38;5;241m.[39mÏƒ, prefix[38;5;241m=[39m[38;5;124mr[39m[38;5;124m"[39m[38;5;124m\[39m[38;5;124meta=[39m[38;5;124m"[39m),
  [1;32m     85[0m )

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:100[0m, in [0;36mtex_value[0;34m(val, err, unit, prefix, suffix, prec, save)[0m
  [1;32m     97[0m [38;5;124;03m"""Generates LaTeX output of a value with units and error."""[39;00m
  [1;32m     99[0m [38;5;28;01mif[39;00m err:
  [0;32m--> 100[0m     val, err, prec [38;5;241m=[39m [43mscientific_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43merr[49m[43m,[49m[43m [49m[43mretprec[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m)[49m
  [1;32m    101[0m [38;5;28;01melse[39;00m:
  [1;32m    102[0m     val [38;5;241m=[39m np[38;5;241m.[39mround(val, prec)

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:91[0m, in [0;36mscientific_round[0;34m(val, retprec, *err)[0m
  [1;32m     89[0m prec [38;5;241m=[39m prec[[38;5;241m0[39m]
  [1;32m     90[0m [38;5;28;01mif[39;00m retprec:
  [0;32m---> 91[0m     [38;5;28;01mreturn[39;00m ([43msmart_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43mprec[49m[43m)[49m, [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m], prec)
  [1;32m     92[0m [38;5;28;01melse[39;00m:
  [1;32m     93[0m     [38;5;28;01mreturn[39;00m (smart_round(val, prec), [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m])

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:71[0m, in [0;36mscientific_round.<locals>.smart_round[0;34m(value, precision)[0m
  [1;32m     70[0m [38;5;28;01mdef[39;00m [38;5;21msmart_round[39m(value, precision):
  [0;32m---> 71[0m     value [38;5;241m=[39m [43mnp[49m[38;5;241;43m.[39;49m[43mround[49m[43m([49m[43mvalue[49m[43m,[49m[43m [49m[43mprecision[49m[43m)[49m
  [1;32m     72[0m     [38;5;28;01mif[39;00m precision [38;5;241m<[39m[38;5;241m=[39m [38;5;241m0[39m:
  [1;32m     73[0m         value [38;5;241m=[39m value[38;5;241m.[39mastype([38;5;28mint[39m)

  File [0;32m<__array_function__ internals>:180[0m, in [0;36mround_[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3731[0m, in [0;36mround_[0;34m(a, decimals, out)[0m
  [1;32m   3722[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3723[0m [38;5;28;01mdef[39;00m [38;5;21mround_[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3724[0m     [38;5;124;03m"""[39;00m
  [1;32m   3725[0m [38;5;124;03m    Round an array to the given number of decimals.[39;00m
  [1;32m   3726[0m
  [0;32m   (...)[0m
  [1;32m   3729[0m [38;5;124;03m    around : equivalent function; see for details.[39;00m
  [1;32m   3730[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3731[0m     [38;5;28;01mreturn[39;00m [43maround[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m<__array_function__ internals>:180[0m, in [0;36maround[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3305[0m, in [0;36maround[0;34m(a, decimals, out)[0m
  [1;32m   3214[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3215[0m [38;5;28;01mdef[39;00m [38;5;21maround[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3216[0m     [38;5;124;03m"""[39;00m
  [1;32m   3217[0m [38;5;124;03m    Evenly round to the given number of decimals.[39;00m
  [1;32m   3218[0m
  [0;32m   (...)[0m
  [1;32m   3303[0m
  [1;32m   3304[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3305[0m     [38;5;28;01mreturn[39;00m [43m_wrapfunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mround[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:57[0m, in [0;36m_wrapfunc[0;34m(obj, method, *args, **kwds)[0m
  [1;32m     54[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)
  [1;32m     56[0m [38;5;28;01mtry[39;00m:
  [0;32m---> 57[0m     [38;5;28;01mreturn[39;00m [43mbound[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
  [1;32m     58[0m [38;5;28;01mexcept[39;00m [38;5;167;01mTypeError[39;00m:
  [1;32m     59[0m     [38;5;66;03m# A TypeError occurs if the object does have such a method in its[39;00m
  [1;32m     60[0m     [38;5;66;03m# class, but its signature is not identical to that of NumPy's. This[39;00m
  [0;32m   (...)[0m
  [1;32m     64[0m     [38;5;66;03m# Call _wrapit from within the except clause to ensure a potential[39;00m
  [1;32m     65[0m     [38;5;66;03m# exception has a traceback chain.[39;00m
  [1;32m     66[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)

  [0;31mOverflowError[0m: signed integer is less than minimum
#+end_example
[[file:./.ob-jupyter/2c8faefa7d6c46f3246c0aaffeba599f2c178a3c.svg]]
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mOverflowError[0m                             Traceback (most recent call last)
  Cell [0;32mIn[9], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mfull_report[49m[43m([49m[43mmodel[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:81[0m, in [0;36mfull_report[0;34m(model)[0m
  [1;32m     77[0m power [38;5;241m=[39m model[38;5;241m.[39mpower()
  [1;32m     78[0m Î· [38;5;241m=[39m model[38;5;241m.[39mefficiency() [38;5;241m*[39m [38;5;241m100[39m
  [1;32m     80[0m [38;5;28mprint[39m(
  [0;32m---> 81[0m     [43mfs[49m[38;5;241;43m.[39;49m[43mtex_value[49m[43m([49m[43mpower[49m[38;5;241;43m.[39;49m[43mvalue[49m[43m,[49m[43m [49m[43merr[49m[38;5;241;43m=[39;49m[43mpower[49m[38;5;241;43m.[39;49m[43mÏƒ[49m[43m,[49m[43m [49m[43mprefix[49m[38;5;241;43m=[39;49m[38;5;124;43m"[39;49m[38;5;124;43mP=[39;49m[38;5;124;43m"[39;49m[43m)[49m,
  [1;32m     82[0m )
  [1;32m     83[0m [38;5;28mprint[39m(
  [1;32m     84[0m     fs[38;5;241m.[39mtex_value(Î·[38;5;241m.[39mvalue, err[38;5;241m=[39mÎ·[38;5;241m.[39mÏƒ, prefix[38;5;241m=[39m[38;5;124mr[39m[38;5;124m"[39m[38;5;124m\[39m[38;5;124meta=[39m[38;5;124m"[39m),
  [1;32m     85[0m )

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:100[0m, in [0;36mtex_value[0;34m(val, err, unit, prefix, suffix, prec, save)[0m
  [1;32m     97[0m [38;5;124;03m"""Generates LaTeX output of a value with units and error."""[39;00m
  [1;32m     99[0m [38;5;28;01mif[39;00m err:
  [0;32m--> 100[0m     val, err, prec [38;5;241m=[39m [43mscientific_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43merr[49m[43m,[49m[43m [49m[43mretprec[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m)[49m
  [1;32m    101[0m [38;5;28;01melse[39;00m:
  [1;32m    102[0m     val [38;5;241m=[39m np[38;5;241m.[39mround(val, prec)

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:91[0m, in [0;36mscientific_round[0;34m(val, retprec, *err)[0m
  [1;32m     89[0m prec [38;5;241m=[39m prec[[38;5;241m0[39m]
  [1;32m     90[0m [38;5;28;01mif[39;00m retprec:
  [0;32m---> 91[0m     [38;5;28;01mreturn[39;00m ([43msmart_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43mprec[49m[43m)[49m, [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m], prec)
  [1;32m     92[0m [38;5;28;01melse[39;00m:
  [1;32m     93[0m     [38;5;28;01mreturn[39;00m (smart_round(val, prec), [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m])

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:71[0m, in [0;36mscientific_round.<locals>.smart_round[0;34m(value, precision)[0m
  [1;32m     70[0m [38;5;28;01mdef[39;00m [38;5;21msmart_round[39m(value, precision):
  [0;32m---> 71[0m     value [38;5;241m=[39m [43mnp[49m[38;5;241;43m.[39;49m[43mround[49m[43m([49m[43mvalue[49m[43m,[49m[43m [49m[43mprecision[49m[43m)[49m
  [1;32m     72[0m     [38;5;28;01mif[39;00m precision [38;5;241m<[39m[38;5;241m=[39m [38;5;241m0[39m:
  [1;32m     73[0m         value [38;5;241m=[39m value[38;5;241m.[39mastype([38;5;28mint[39m)

  File [0;32m<__array_function__ internals>:180[0m, in [0;36mround_[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3731[0m, in [0;36mround_[0;34m(a, decimals, out)[0m
  [1;32m   3722[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3723[0m [38;5;28;01mdef[39;00m [38;5;21mround_[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3724[0m     [38;5;124;03m"""[39;00m
  [1;32m   3725[0m [38;5;124;03m    Round an array to the given number of decimals.[39;00m
  [1;32m   3726[0m
  [0;32m   (...)[0m
  [1;32m   3729[0m [38;5;124;03m    around : equivalent function; see for details.[39;00m
  [1;32m   3730[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3731[0m     [38;5;28;01mreturn[39;00m [43maround[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m<__array_function__ internals>:180[0m, in [0;36maround[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3305[0m, in [0;36maround[0;34m(a, decimals, out)[0m
  [1;32m   3214[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3215[0m [38;5;28;01mdef[39;00m [38;5;21maround[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3216[0m     [38;5;124;03m"""[39;00m
  [1;32m   3217[0m [38;5;124;03m    Evenly round to the given number of decimals.[39;00m
  [1;32m   3218[0m
  [0;32m   (...)[0m
  [1;32m   3303[0m
  [1;32m   3304[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3305[0m     [38;5;28;01mreturn[39;00m [43m_wrapfunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mround[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:57[0m, in [0;36m_wrapfunc[0;34m(obj, method, *args, **kwds)[0m
  [1;32m     54[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)
  [1;32m     56[0m [38;5;28;01mtry[39;00m:
  [0;32m---> 57[0m     [38;5;28;01mreturn[39;00m [43mbound[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
  [1;32m     58[0m [38;5;28;01mexcept[39;00m [38;5;167;01mTypeError[39;00m:
  [1;32m     59[0m     [38;5;66;03m# A TypeError occurs if the object does have such a method in its[39;00m
  [1;32m     60[0m     [38;5;66;03m# class, but its signature is not identical to that of NumPy's. This[39;00m
  [0;32m   (...)[0m
  [1;32m     64[0m     [38;5;66;03m# Call _wrapit from within the except clause to ensure a potential[39;00m
  [1;32m     65[0m     [38;5;66;03m# exception has a traceback chain.[39;00m
  [1;32m     66[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)

  [0;31mOverflowError[0m: signed integer is less than minimum
#+end_example
[[file:./.ob-jupyter/e4ba8a91693f3814bb875910a11a004e4edd227b.svg]]
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mOverflowError[0m                             Traceback (most recent call last)
  Cell [0;32mIn[12], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mfull_report[49m[43m([49m[43mmodel[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:81[0m, in [0;36mfull_report[0;34m(model)[0m
  [1;32m     77[0m power [38;5;241m=[39m model[38;5;241m.[39mpower()
  [1;32m     78[0m Î· [38;5;241m=[39m model[38;5;241m.[39mefficiency() [38;5;241m*[39m [38;5;241m100[39m
  [1;32m     80[0m [38;5;28mprint[39m(
  [0;32m---> 81[0m     [43mfs[49m[38;5;241;43m.[39;49m[43mtex_value[49m[43m([49m[43mpower[49m[38;5;241;43m.[39;49m[43mvalue[49m[43m,[49m[43m [49m[43merr[49m[38;5;241;43m=[39;49m[43mpower[49m[38;5;241;43m.[39;49m[43mÏƒ[49m[43m,[49m[43m [49m[43mprefix[49m[38;5;241;43m=[39;49m[38;5;124;43m"[39;49m[38;5;124;43mP=[39;49m[38;5;124;43m"[39;49m[43m)[49m,
  [1;32m     82[0m )
  [1;32m     83[0m [38;5;28mprint[39m(
  [1;32m     84[0m     fs[38;5;241m.[39mtex_value(Î·[38;5;241m.[39mvalue, err[38;5;241m=[39mÎ·[38;5;241m.[39mÏƒ, prefix[38;5;241m=[39m[38;5;124mr[39m[38;5;124m"[39m[38;5;124m\[39m[38;5;124meta=[39m[38;5;124m"[39m),
  [1;32m     85[0m )

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:100[0m, in [0;36mtex_value[0;34m(val, err, unit, prefix, suffix, prec, save)[0m
  [1;32m     97[0m [38;5;124;03m"""Generates LaTeX output of a value with units and error."""[39;00m
  [1;32m     99[0m [38;5;28;01mif[39;00m err:
  [0;32m--> 100[0m     val, err, prec [38;5;241m=[39m [43mscientific_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43merr[49m[43m,[49m[43m [49m[43mretprec[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m)[49m
  [1;32m    101[0m [38;5;28;01melse[39;00m:
  [1;32m    102[0m     val [38;5;241m=[39m np[38;5;241m.[39mround(val, prec)

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:91[0m, in [0;36mscientific_round[0;34m(val, retprec, *err)[0m
  [1;32m     89[0m prec [38;5;241m=[39m prec[[38;5;241m0[39m]
  [1;32m     90[0m [38;5;28;01mif[39;00m retprec:
  [0;32m---> 91[0m     [38;5;28;01mreturn[39;00m ([43msmart_round[49m[43m([49m[43mval[49m[43m,[49m[43m [49m[43mprec[49m[43m)[49m, [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m], prec)
  [1;32m     92[0m [38;5;28;01melse[39;00m:
  [1;32m     93[0m     [38;5;28;01mreturn[39;00m (smart_round(val, prec), [38;5;241m*[39msmart_round(err, prec)[[38;5;241m0[39m])

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/figsaver.py:71[0m, in [0;36mscientific_round.<locals>.smart_round[0;34m(value, precision)[0m
  [1;32m     70[0m [38;5;28;01mdef[39;00m [38;5;21msmart_round[39m(value, precision):
  [0;32m---> 71[0m     value [38;5;241m=[39m [43mnp[49m[38;5;241;43m.[39;49m[43mround[49m[43m([49m[43mvalue[49m[43m,[49m[43m [49m[43mprecision[49m[43m)[49m
  [1;32m     72[0m     [38;5;28;01mif[39;00m precision [38;5;241m<[39m[38;5;241m=[39m [38;5;241m0[39m:
  [1;32m     73[0m         value [38;5;241m=[39m value[38;5;241m.[39mastype([38;5;28mint[39m)

  File [0;32m<__array_function__ internals>:180[0m, in [0;36mround_[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3731[0m, in [0;36mround_[0;34m(a, decimals, out)[0m
  [1;32m   3722[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3723[0m [38;5;28;01mdef[39;00m [38;5;21mround_[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3724[0m     [38;5;124;03m"""[39;00m
  [1;32m   3725[0m [38;5;124;03m    Round an array to the given number of decimals.[39;00m
  [1;32m   3726[0m
  [0;32m   (...)[0m
  [1;32m   3729[0m [38;5;124;03m    around : equivalent function; see for details.[39;00m
  [1;32m   3730[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3731[0m     [38;5;28;01mreturn[39;00m [43maround[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m<__array_function__ internals>:180[0m, in [0;36maround[0;34m(*args, **kwargs)[0m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:3305[0m, in [0;36maround[0;34m(a, decimals, out)[0m
  [1;32m   3214[0m [38;5;129m@array_function_dispatch[39m(_around_dispatcher)
  [1;32m   3215[0m [38;5;28;01mdef[39;00m [38;5;21maround[39m(a, decimals[38;5;241m=[39m[38;5;241m0[39m, out[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [1;32m   3216[0m     [38;5;124;03m"""[39;00m
  [1;32m   3217[0m [38;5;124;03m    Evenly round to the given number of decimals.[39;00m
  [1;32m   3218[0m
  [0;32m   (...)[0m
  [1;32m   3303[0m
  [1;32m   3304[0m [38;5;124;03m    """[39;00m
  [0;32m-> 3305[0m     [38;5;28;01mreturn[39;00m [43m_wrapfunc[49m[43m([49m[43ma[49m[43m,[49m[43m [49m[38;5;124;43m'[39;49m[38;5;124;43mround[39;49m[38;5;124;43m'[39;49m[43m,[49m[43m [49m[43mdecimals[49m[38;5;241;43m=[39;49m[43mdecimals[49m[43m,[49m[43m [49m[43mout[49m[38;5;241;43m=[39;49m[43mout[49m[43m)[49m

  File [0;32m/nix/store/z03mqgq14mjd837rg1v4xir51wz7naqs-python3-3.9.15-env/lib/python3.9/site-packages/numpy/core/fromnumeric.py:57[0m, in [0;36m_wrapfunc[0;34m(obj, method, *args, **kwds)[0m
  [1;32m     54[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)
  [1;32m     56[0m [38;5;28;01mtry[39;00m:
  [0;32m---> 57[0m     [38;5;28;01mreturn[39;00m [43mbound[49m[43m([49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwds[49m[43m)[49m
  [1;32m     58[0m [38;5;28;01mexcept[39;00m [38;5;167;01mTypeError[39;00m:
  [1;32m     59[0m     [38;5;66;03m# A TypeError occurs if the object does have such a method in its[39;00m
  [1;32m     60[0m     [38;5;66;03m# class, but its signature is not identical to that of NumPy's. This[39;00m
  [0;32m   (...)[0m
  [1;32m     64[0m     [38;5;66;03m# Call _wrapit from within the except clause to ensure a potential[39;00m
  [1;32m     65[0m     [38;5;66;03m# exception has a traceback chain.[39;00m
  [1;32m     66[0m     [38;5;28;01mreturn[39;00m _wrapit(obj, method, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwds)

  [0;31mOverflowError[0m: signed integer is less than minimum
#+end_example
[[file:./.ob-jupyter/cf200e352c6e8ce6af5a5ae0654c7b8f9fe7ed12.svg]]
:END:

* Scans
In this section we run some parameter scans on the otto cycle.

** Switching Speed
:PROPERTIES:
:header-args: :tangle speed_coupling_scan.py :session speed_coupling_scan :noweb yes :async yes
:END:
Inspired by cite:Wiedmann2020Mar, we will begin with a scan of coupling strength vs coupling switching speed.

*** Model
A basic otto cycle that has a finite power output but without resonance.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  def timings(Ï„_c, Ï„_i):
      Ï„_th = (1 - 2 * Ï„_c) / 2
      Ï„_i_on = (Ï„_th - 2*Ï„_i)
      timings_H = (0, Ï„_c, Ï„_c + Ï„_th, 2*Ï„_c + Ï„_th)
      timings_L_hot = (Ï„_c, Ï„_c + Ï„_i, Ï„_c + Ï„_i + Ï„_i_on, Ï„_c + 2 * Ï„_i + Ï„_i_on)

      timings_L_cold = tuple(time + timings_H[2] for time in timings_L_hot)

      return timings_H, (timings_L_cold, timings_L_hot)
#+end_src

#+RESULTS:


- no shift, to keep things simple

#+begin_src jupyter-python
  (p_H, p_L) = timings(0.1, 0.3)
  prototype = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[2, 2],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A model for scanning coupling strength and interactin switch times.",
      k_max=3,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "tanhsinh"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=p_H,
      timings_L=p_L,
      streaming_mode=True,
      shift_to_resonance=(False, False),
  )

#+end_src

#+RESULTS:

*** Scan Definition
As hamiltonian switching is not very interesting per-se, as it is
diagonal and directly translates into addional power vs longer
coupling we change the switching speed of the interaction and the coupling strength.


#+begin_src jupyter-python
  from speed_coupling_scan import *
  Î´s = np.round(np.linspace(.1, 1, 2), 3)
  Ï„_Is = np.round(np.linspace(.01, .3, 4), 3)
  Ï„_Is
#+end_src

#+RESULTS:
:RESULTS:
: array([0.01, 0.3 ])
[[file:./.ob-jupyter/f5f24c1792dd4e341bb5129084138c923c112cff.svg]]
:END:

#+begin_src jupyter-python
  models = []

  import itertools

  for Ï„_I, Î´ in itertools.product(Ï„_Is, Î´s):
      (p_H, p_L) = timings(0.1, Ï„_I)

      model = prototype.copy()
      model.Î´ = [Î´, Î´]
      model.timings_H = p_H
      model.timings_L = p_L
      models.append(model)


  ot.plot_cycles(models[:: len(Î´s)])
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/21d6323b0d78ab0ec2e4b4179996c721e63accc5.svg]]
:END:

*** TODO Integration
:PROPERTIES:
:header-args: :tangle speed_coupling_integration.py :session speed_coupling_integration :noweb yes :async yes
:END:

#+begin_src jupyter-python
  from speed_coupling_scan import *

  ot.integrate_online_multi(models, 1000)
#+end_src

#+RESULTS:
:RESULTS:
#+begin_example
    [INFO    hops.core.integration     886128] Choosing the nonlinear integrator.
    [INFO    root                      886128] Starting analysis process.
    [INFO    root                      886128] Started analysis process with pid 897281.
    [INFO    hops.core.hierarchy_data  886128] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_1b49c110fd8a755b72e61454048bc9cd4fb981374ae3832f619d47b90770109c.fifo
    [INFO    hops.core.integration     886128] Using 16 integrators.
    [INFO    hops.core.integration     886128] Some 92 trajectories have to be integrated.
    [INFO    hops.core.integration     886128] Using 165 hierarchy states.
    100% 92/92 [01:40<00:00,  1.09s/it]
    [INFO    hops.core.integration     886128] Choosing the nonlinear integrator.
    [INFO    root                      886128] Starting analysis process.
    [INFO    root                      886128] Started analysis process with pid 897607.
    [INFO    hops.core.hierarchy_data  886128] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_b2f36e79ac179fdfba0e46c5cdbf65cfd97bde215038b8caa3e4de2bb7050124.fifo
    [INFO    hops.core.integration     886128] Using 16 integrators.
    [INFO    hops.core.integration     886128] Some 92 trajectories have to be integrated.
    [INFO    hops.core.integration     886128] Using 165 hierarchy states.
  100% 92/92 [01:52<00:00,  1.22s/it]
    [INFO    hops.core.integration     886128] Choosing the nonlinear integrator.
    [INFO    root                      886128] Starting analysis process.
    [INFO    root                      886128] Started analysis process with pid 897765.
    [INFO    hops.core.hierarchy_data  886128] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_6c301efacb83c69c42557b8c3a8de76d09e439cd52f90101f05daf0c71d4427b.fifo
    [INFO    hops.core.integration     886128] Using 16 integrators.
    [INFO    hops.core.integration     886128] Some 92 trajectories have to be integrated.
    [INFO    hops.core.integration     886128] Using 165 hierarchy states.
  100% 92/92 [01:18<00:00,  1.17it/s]
    [INFO    hops.core.integration     886128] Choosing the nonlinear integrator.
    [INFO    root                      886128] Starting analysis process.
    [INFO    root                      886128] Started analysis process with pid 898045.
    [INFO    hops.core.hierarchy_data  886128] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_14c86f979bcc5064eb021c0ca50c3e2713a486a461531f459344f70ce09d12f7.fifo
    [INFO    hops.core.integration     886128] Using 16 integrators.
    [INFO    hops.core.integration     886128] Some 92 trajectories have to be integrated.
    [INFO    hops.core.integration     886128] Using 165 hierarchy states.
  100% 92/92 [01:22<00:00,  1.12it/s]
#+end_example
[[file:./.ob-jupyter/a485e34dda49ecacfff0b02110a41beccf2801e6.svg]]
:END:


*** Analysis
:PROPERTIES:
:header-args: :tangle speed_coupling_analysis.py :session speed_coupling_analysis :noweb yes :async yes
:END:

#+begin_src jupyter-python
  from speed_coupling_scan import *
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/aca5fea36261a89e371f65460fe5438b4e38708d.svg]]

#+begin_src jupyter-python
  import random
  #powers = np.array([model.power().value for model in models])
  powers = np.array([random.random() for model in models])
  normalized_powers = powers - powers.min()
  normalized_powers /= normalized_powers.max()
  colors = [Blues(power) for power in normalized_powers]
  ax1 = plt.gcf().add_subplot(111, projection='3d')

  _xx, _yy = np.meshgrid(Î´s, Ï„_Is)
  x, y = _xx.ravel(), _yy.ravel()
  dx = (Î´s[1] - Î´s[0])
  dy = (Ï„_Is[1] - Ï„_Is[0])
  x -= dx /2
  y -= dy /2
  ax1.bar3d(x, y, np.zeros_like(powers), dx, dy, powers, color=colors)
  ax1.set_xticks(Î´s)
  ax1.set_yticks(Ï„_Is)

  ax1.set_xlabel(r"$\delta$")
  ax1.set_ylabel(r"$\tau_I$")
  ax1.set_zlabel(r"$P$")
#+end_src

#+RESULTS:
:RESULTS:
: Text(0.5, 0, '$P$')
[[file:./.ob-jupyter/07d359f69dd89aed1ac3d9254801f732bdce9e03.svg]]
:END:


** Coupling and System Switching overlap
Let's see if it helps switching system and interaction at the same time.
