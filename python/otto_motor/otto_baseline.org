#+PROPERTY: header-args :session otto_baseline :kernel python :pandoc no :async yes :tangle otto_baseline.py

* Boilerplate
#+name: boilerplate
#+begin_src jupyter-python :results none
    import figsaver as fs
    import plot_utils as pu
    from hiro_models.one_qubit_model import StocProcTolerances
    from hiro_models.otto_cycle import OttoEngine
    import hiro_models.model_auxiliary as aux
    import numpy as np
    import qutip as qt
    import utilities as ut
    import stocproc
    import matplotlib.pyplot as plt
    import otto_utilities as ot

    import ray
    ray.shutdown()

    ray.init(address='auto')
    #ray.init()
    from hops.util.logging_setup import logging_setup
    import logging
    logging_setup(logging.INFO)
    plt.rcParams['figure.figsize'] = (12,4)
#+end_src

* Model: Baseline
:PROPERTIES:
:header-args: :tangle baseline.py :session baseline :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:
: 2022-12-10 18:36:09,974       INFO worker.py:956 -- Connecting to existing Ray cluster at address: 10.0.0.102:6379

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[1, 1],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle that actually works.",
      k_max=4,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "fft"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=((0.6, 0.7, 0.9, 1), (0.1, 0.2, 0.4, 0.5)),
      streaming_mode=True,
      # solver_args=dict(rtol=1e-3, atol=1e-3)
  )
#+end_src

#+RESULTS:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,075 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:
: [2m[36m(pid=gcs_server)[0m [2022-12-10 18:34:40,076 E 836176 836176] (gcs_server) gcs_server.cc:283: Failed to get the resource load: GrpcUnavailable: RPC Error message: Socket closed; RPC Error details:


#+begin_src jupyter-python :tangle no
  ot.plot_cycle(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/b9c6fe129cc6f48b499ba5507d42fad2b917e830.svg]]
:END:


#+begin_src jupyter-python :tangle no
  ot.integrate_online(model, 5000, analyze_kwargs=dict(every=100))
#+end_src

#+RESULTS:
:RESULTS:
#+begin_example
  [INFO    hops.core.integration     965921] Choosing the nonlinear integrator.
  [INFO    root                      965921] Starting analysis process.
  [INFO    root                      965921] Started analysis process with pid 967071.
  [INFO    hops.core.hierarchy_data  965921] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_b28fda1ae09e50be64694fbb2886a0c43f329c2036a918a72db2346af5779470.fifo
  [INFO    hops.core.integration     965921] Using 32 integrators.
  [INFO    hops.core.integration     965921] Some 5000 trajectories have to be integrated.
  [INFO    hops.core.integration     965921] Using 1820 hierarchy states.
    0% 0/5000 [00:00<?, ?it/s][A
    0% 1/5000 [00:29<41:09:33, 29.64s/it][A
  0% 3/5000 [00:32<14:56:18, 10.76s/it][A
  0% 5/5000 [00:34<9:41:25,  6.98s/it] [A
  0% 7/5000 [00:38<7:32:21,  5.44s/it][A
  0% 9/5000 [00:41<6:22:25,  4.60s/it][A
  0% 11/5000 [00:44<5:38:29,  4.07s/it][A
  0% 13/5000 [00:48<5:09:29,  3.72s/it][A
  0% 15/5000 [00:51<4:45:46,  3.44s/it][A
  0% 17/5000 [00:54<4:28:26,  3.23s/it][A
  0% 19/5000 [00:59<4:19:33,  3.13s/it][A
  0% 21/5000 [01:03<4:10:07,  3.01s/it][A
  0% 23/5000 [01:06<4:01:37,  2.91s/it][A
  0% 25/5000 [01:10<3:52:43,  2.81s/it][A
  1% 27/5000 [01:13<3:46:00,  2.73s/it][A
  1% 29/5000 [01:17<3:40:53,  2.67s/it][A
  1% 31/5000 [01:21<3:36:31,  2.61s/it][A
  1% 33/5000 [01:24<3:32:32,  2.57s/it][A
  1% 35/5000 [01:28<3:29:11,  2.53s/it][A
  1% 37/5000 [01:32<3:25:42,  2.49s/it][A
  1% 39/5000 [01:35<3:22:36,  2.45s/it][A
  1% 41/5000 [01:39<3:19:46,  2.42s/it][A
  1% 43/5000 [01:41<3:15:58,  2.37s/it][A
  1% 45/5000 [01:45<3:12:47,  2.33s/it][A
  1% 47/5000 [01:48<3:10:01,  2.30s/it][A
  1% 49/5000 [01:51<3:08:11,  2.28s/it][A
  1% 51/5000 [01:55<3:06:29,  2.26s/it][A
  1% 53/5000 [01:59<3:05:45,  2.25s/it][A
  1% 55/5000 [02:02<3:03:35,  2.23s/it][A
  1% 57/5000 [02:06<3:02:23,  2.21s/it][A
  1% 59/5000 [02:10<3:01:33,  2.20s/it][A
  1% 61/5000 [02:13<2:59:48,  2.18s/it][A
  1% 63/5000 [02:16<2:57:59,  2.16s/it][A
  1% 65/5000 [02:19<2:56:43,  2.15s/it][A
  1% 67/5000 [02:23<2:55:29,  2.13s/it][A
  1% 69/5000 [02:26<2:54:37,  2.12s/it][A
  1% 71/5000 [02:29<2:53:19,  2.11s/it][A
  1% 73/5000 [02:33<2:52:19,  2.10s/it][A
  2% 75/5000 [02:36<2:51:22,  2.09s/it][A
  2% 77/5000 [02:39<2:50:20,  2.08s/it][A
  2% 79/5000 [02:42<2:49:08,  2.06s/it][A
  2% 81/5000 [02:45<2:47:53,  2.05s/it][A[INFO    hops.core.signal_delay    965921] caught sig 'SIGINT'
  [INFO    hops.core.signal_delay    965921] caught 1 signal(s)
  [INFO    hops.core.signal_delay    965921] emit signal 'SIGINT'
  [INFO    hops.core.signal_delay    965921] caught sig 'SIGINT'
  2% 81/5000 [02:47<2:49:23,  2.07s/it]
  2022-12-10 18:39:02,724       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,725       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,725       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,726       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,726       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,727       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,727       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,728       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,728       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,729       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,729       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,730       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,730       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,731       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,731       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,732       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,732       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,733       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,733       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,734       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,734       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,735       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,735       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,736       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,736       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,737       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,737       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,738       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,738       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,739       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,739       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-10 18:39:02,740       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  [INFO    hops.core.signal_delay    965921] caught 1 signal(s)
  [INFO    hops.core.signal_delay    965921] emit signal 'SIGINT'
  [INFO    hops.core.signal_delay    965921] caught sig 'SIGINT'
  [INFO    hops.core.signal_delay    965921] caught 1 signal(s)
  [INFO    hops.core.signal_delay    965921] emit signal 'SIGINT'
#+end_example
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mKeyboardInterrupt[0m                         Traceback (most recent call last)
  Cell [0;32mIn[9], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mintegrate_online[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[38;5;241;43m5000[39;49m[43m,[49m[43m [49m[43manalyze_kwargs[49m[38;5;241;43m=[39;49m[38;5;28;43mdict[39;49m[43m([49m[43mevery[49m[38;5;241;43m=[39;49m[38;5;241;43m100[39;49m[43m)[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:155[0m, in [0;36mintegrate_online[0;34m(model, n, stream_folder, **kwargs)[0m
  [1;32m    154[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online[39m(model, n, stream_folder[38;5;241m=[39m[38;5;28;01mNone[39;00m, [38;5;241m*[39m[38;5;241m*[39mkwargs):
  [0;32m--> 155[0m     [43maux[49m[38;5;241;43m.[39;49m[43mintegrate[49m[43m([49m
  [1;32m    156[0m [43m        [49m[43mmodel[49m[43m,[49m
  [1;32m    157[0m [43m        [49m[43mn[49m[43m,[49m
  [1;32m    158[0m [43m        [49m[43mstream_file[49m[38;5;241;43m=[39;49m[43m([49m[38;5;124;43m"[39;49m[38;5;124;43m"[39;49m[43m [49m[38;5;28;43;01mif[39;49;00m[43m [49m[43mstream_folder[49m[43m [49m[38;5;129;43;01mis[39;49;00m[43m [49m[38;5;28;43;01mNone[39;49;00m[43m [49m[38;5;28;43;01melse[39;49;00m[43m [49m[43mstream_folder[49m[43m)[49m
  [1;32m    159[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43mf[39;49m[38;5;124;43m"[39;49m[38;5;124;43mresults_[39;49m[38;5;132;43;01m{[39;49;00m[43mmodel[49m[38;5;241;43m.[39;49m[43mhexhash[49m[38;5;132;43;01m}[39;49;00m[38;5;124;43m.fifo[39;49m[38;5;124;43m"[39;49m[43m,[49m
  [1;32m    160[0m [43m        [49m[43manalyze[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m,[49m
  [1;32m    161[0m [43m        [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m,[49m
  [1;32m    162[0m [43m    [49m[43m)[49m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:201[0m, in [0;36mintegrate[0;34m(model, n, data_path, clear_pd, single_process, stream_file, analyze, results_path, analyze_kwargs)[0m
  [1;32m    199[0m         supervisor[38;5;241m.[39mintegrate_single_process(clear_pd)
  [1;32m    200[0m     [38;5;28;01melse[39;00m:
  [0;32m--> 201[0m         supervisor[38;5;241m.[39mintegrate(clear_pd)
  [1;32m    203[0m cleanup([38;5;241m0[39m)

  File [0;32m~/src/hops/hops/core/signal_delay.py:87[0m, in [0;36msig_delay.__exit__[0;34m(self, exc_type, exc_val, exc_tb)[0m
  [1;32m     84[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught) [38;5;241m>[39m [38;5;241m0[39m [38;5;129;01mand[39;00m [38;5;28mself[39m[38;5;241m.[39mhandler [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
  [1;32m     85[0m     [38;5;28mself[39m[38;5;241m.[39mhandler([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught)
  [0;32m---> 87[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43m_restore[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:68[0m, in [0;36msig_delay._restore[0;34m(self)[0m
  [1;32m     66[0m [38;5;28;01mfor[39;00m i, s [38;5;129;01min[39;00m [38;5;28menumerate[39m([38;5;28mself[39m[38;5;241m.[39msigs):
  [1;32m     67[0m     signal[38;5;241m.[39msignal(s, [38;5;28mself[39m[38;5;241m.[39mold_handlers[i])
  [0;32m---> 68[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43msigh[49m[38;5;241;43m.[39;49m[43memit[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:42[0m, in [0;36mSigHandler.emit[0;34m(self)[0m
  [1;32m     40[0m [38;5;28;01mfor[39;00m s [38;5;129;01min[39;00m [38;5;28mself[39m[38;5;241m.[39msigs_caught:
  [1;32m     41[0m     log[38;5;241m.[39minfo([38;5;124m"[39m[38;5;124memit signal [39m[38;5;124m'[39m[38;5;132;01m{}[39;00m[38;5;124m'[39m[38;5;124m"[39m[38;5;241m.[39mformat(SIG_MAP[s]))
  [0;32m---> 42[0m     [43mos[49m[38;5;241;43m.[39;49m[43mkill[49m[43m([49m[43mos[49m[38;5;241;43m.[39;49m[43mgetpid[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43ms[49m[43m)[49m

  [0;31mKeyboardInterrupt[0m:
#+end_example
:END:




#+begin_example
  100% 1314/1314 [31:39<00:00,  1.45s/it]
  [INFO    hops.core.integration     177538] Choosing the nonlinear integrator.
  [INFO    root                      177538] Starting analysis process.
  [INFO    root                      177538] Started analysis process with pid 218822.
  [INFO    hops.core.hierarchy_data  177538] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_b28fda1ae09e50be64694fbb2886a0c43f329c2036a918a72db2346af5779470.fifo
  [INFO    hops.core.integration     177538] Using 32 integrators.
  [INFO    hops.core.integration     177538] Some 0 trajectories have to be integrated.
  [INFO    hops.core.integration     177538] Using 1820 hierarchy states.
  0it [00:00, ?it/s]
  [2m[36m(raylet)[0m Spilled 2746 MiB, 1285 objects, write throughput 121 MiB/s. Set RAY_verbose_spill_logs=0 to disable this message.
#+end_example

** Results
:PROPERTIES:
:header-args:  :session baseline_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
    import otto_utilities as ot
    from baseline import model

    ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Energy | > |
[[file:./.ob-jupyter/35dcfbedcee78b470c1b319c79069c0e810714a4.svg]]
:END:



#+begin_src jupyter-python
  model.efficiency(), model.power()
#+end_src

#+RESULTS:
| EnsembleValue | (((4999 0.30111959935298505 0.004893266566388082))) | EnsembleValue | (((4999 -0.002945848125810441 2.901871200949723e-05))) |


#+begin_src jupyter-python
    ot.full_report(model)
#+end_src

#+RESULTS:
:RESULTS:
[[file:./.ob-jupyter/0852c11e266a37e92a5294569e34abb5695b2ecd.svg]]
: [2m[36m(raylet)[0m Spilled 2746 MiB, 1285 objects, write throughput 121 MiB/s. Set RAY_verbose_spill_logs=0 to disable this message.
:END:
:RESULTS:
: \(P=-0.002946\pm 0.000029\)
: \(\eta=30.1\pm 0.5\)
[[file:./.ob-jupyter/8886ba10a0709961381a019dc9c7fa14126142c2.svg]]
[[file:./.ob-jupyter/ff76c13b95ea6b171bfd66927097c017aea9efd9.svg]]
:END:

* Model: Baseline, continously coupled
:PROPERTIES:
:header-args: :tangle baseline_cc.py :session baseline_cc :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output without coupling modulation.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[1, 1],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle that actually works.",
      k_max=4,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "fft"],
      Î”=1,
      num_cycles=5,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=(None, None),
      streaming_mode=True,
  )

  ot.plot_cycle(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/46af558100f1bf6a8d5d1a125a7e3116ba1d2dff.svg]]
:END:


#+begin_src jupyter-python :tangle no
  ot.integrate_online(model, 5000, analyze_kwargs=dict(every=500))
#+end_src

#+RESULTS:
#+begin_example
  [INFO    hops.core.integration     220084] Choosing the nonlinear integrator.
  [INFO    root                      220084] Starting analysis process.
  [INFO    root                      220084] Started analysis process with pid 224653.
  [INFO    hops.core.hierarchy_data  220084] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_f0cbfe14927cd3391051a14d81391c4135087e9e3a2908e3242a8393e98e0640.fifo
  [INFO    hops.core.integration     220084] Using 32 integrators.
  [INFO    hops.core.integration     220084] Some 4925 trajectories have to be integrated.
  [INFO    hops.core.integration     220084] Using 1820 hierarchy states.
   31% 1529/4925 [39:31<1:27:46,  1.55s/it][2m[36m(raylet)[0m Spilled 2746 MiB, 1285 objects, write throughput 121 MiB/s. Set RAY_verbose_spill_logs=0 to disable this message.
  100% 4925/4925 [1:27:30<00:00,  1.07s/it]
#+end_example

** Results
:PROPERTIES:
:header-args:  :session baseline_cc_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
    import otto_utilities as ot
    from baseline_cc import model

    ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Energy | > |
[[file:./.ob-jupyter/8dcf44f140c595dc41af80bf639a4f09febd3ecd.svg]]
[[file:./.ob-jupyter/6b12c2b534b24a0f30d232e3f27f9224e1fff5d3.svg]]
:END:


#+begin_src jupyter-python
  model.efficiency().value, model.power().value
#+end_src

#+RESULTS:
| 0.04458645456091148 | -0.001717584422747308 |


#+begin_src jupyter-python
    ot.full_report(model)
#+end_src

#+RESULTS:
:RESULTS:
: \(P=-0.001718\pm 0.000022\)
: \(\eta=4.46\pm 0.09\)
[[file:./.ob-jupyter/eefdee2f2a0ee389678d59da69931e4273c3099e.svg]]
[[file:./.ob-jupyter/7a9f9b4f3bfcdae6c575cdf9a48181f7b8bdf3a0.svg]]
:END:

* Model: Baseline Without Resonance
:PROPERTIES:
:header-args: :tangle baseline_noshift.py :session baseline_noshift :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output but without resonance.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  model = OttoEngine(
        Î´=[0.4, 0.4],
        Ï‰_c=[1, 1],
        Ïˆ_0=qt.basis([2], [1]),
        description=f"A basic near-markovian, weakly coupled Otto Cycle that actually works.",
        k_max=4,
        bcf_terms=[6] * 2,
        truncation_scheme="simplex",
        driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
        thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
        T=[1, 10],
        therm_methods=["tanhsinh", "tanhsinh"],
        Î”=1,
        num_cycles=5,
        Î˜=1.5 / 0.05,
        dt=0.001,
        timings_H=(0, 0.1, 0.5, 0.6),
        timings_L=((0.6, 0.7, 0.9, 1), (0.1, 0.2, 0.4, 0.5)),
        streaming_mode=True,
      shift_to_resonance=(False, False),
        # solver_args=dict(rtol=1e-3, atol=1e-3)
    )
  ot.plot_cycle(model)
#+end_src
#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/acddb332ae845425647d38aa9f7101a642cf4b0e.svg]]
:END:


#+begin_src jupyter-python
  ot.plot_sd_overview(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\omega$ | ylabel= | Spectral Density | > |
[[file:./.ob-jupyter/4839b4ab9e0d0198f864dfb8c5bcbdae241a15ad.svg]]
:END:


#+begin_src jupyter-python :tangle no
  ot.integrate_online(model, 5000)
#+end_src

#+RESULTS:
:RESULTS:
: [INFO    hops.core.signal_delay    1570847] emit signal 'SIGINT'
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mKeyboardInterrupt[0m                         Traceback (most recent call last)
  Cell [0;32mIn[47], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mintegrate_online[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[38;5;241;43m5000[39;49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:155[0m, in [0;36mintegrate_online[0;34m(model, n, stream_folder, **kwargs)[0m
  [1;32m    154[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online[39m(model, n, stream_folder[38;5;241m=[39m[38;5;28;01mNone[39;00m, [38;5;241m*[39m[38;5;241m*[39mkwargs):
  [0;32m--> 155[0m     [43maux[49m[38;5;241;43m.[39;49m[43mintegrate[49m[43m([49m
  [1;32m    156[0m [43m        [49m[43mmodel[49m[43m,[49m
  [1;32m    157[0m [43m        [49m[43mn[49m[43m,[49m
  [1;32m    158[0m [43m        [49m[43mstream_file[49m[38;5;241;43m=[39;49m[43m([49m[38;5;124;43m"[39;49m[38;5;124;43m"[39;49m[43m [49m[38;5;28;43;01mif[39;49;00m[43m [49m[43mstream_folder[49m[43m [49m[38;5;129;43;01mis[39;49;00m[43m [49m[38;5;28;43;01mNone[39;49;00m[43m [49m[38;5;28;43;01melse[39;49;00m[43m [49m[43mstream_folder[49m[43m)[49m
  [1;32m    159[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43mf[39;49m[38;5;124;43m"[39;49m[38;5;124;43mresults_[39;49m[38;5;132;43;01m{[39;49;00m[43mmodel[49m[38;5;241;43m.[39;49m[43mhexhash[49m[38;5;132;43;01m}[39;49;00m[38;5;124;43m.fifo[39;49m[38;5;124;43m"[39;49m[43m,[49m
  [1;32m    160[0m [43m        [49m[43manalyze[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m,[49m
  [1;32m    161[0m [43m        [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m,[49m
  [1;32m    162[0m [43m    [49m[43m)[49m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:201[0m, in [0;36mintegrate[0;34m(model, n, data_path, clear_pd, single_process, stream_file, analyze, results_path, analyze_kwargs)[0m
  [1;32m    199[0m         supervisor[38;5;241m.[39mintegrate_single_process(clear_pd)
  [1;32m    200[0m     [38;5;28;01melse[39;00m:
  [0;32m--> 201[0m         supervisor[38;5;241m.[39mintegrate(clear_pd)
  [1;32m    203[0m cleanup([38;5;241m0[39m)

  File [0;32m~/src/hops/hops/core/signal_delay.py:87[0m, in [0;36msig_delay.__exit__[0;34m(self, exc_type, exc_val, exc_tb)[0m
  [1;32m     84[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught) [38;5;241m>[39m [38;5;241m0[39m [38;5;129;01mand[39;00m [38;5;28mself[39m[38;5;241m.[39mhandler [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
  [1;32m     85[0m     [38;5;28mself[39m[38;5;241m.[39mhandler([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught)
  [0;32m---> 87[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43m_restore[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:68[0m, in [0;36msig_delay._restore[0;34m(self)[0m
  [1;32m     66[0m [38;5;28;01mfor[39;00m i, s [38;5;129;01min[39;00m [38;5;28menumerate[39m([38;5;28mself[39m[38;5;241m.[39msigs):
  [1;32m     67[0m     signal[38;5;241m.[39msignal(s, [38;5;28mself[39m[38;5;241m.[39mold_handlers[i])
  [0;32m---> 68[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43msigh[49m[38;5;241;43m.[39;49m[43memit[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:42[0m, in [0;36mSigHandler.emit[0;34m(self)[0m
  [1;32m     40[0m [38;5;28;01mfor[39;00m s [38;5;129;01min[39;00m [38;5;28mself[39m[38;5;241m.[39msigs_caught:
  [1;32m     41[0m     log[38;5;241m.[39minfo([38;5;124m"[39m[38;5;124memit signal [39m[38;5;124m'[39m[38;5;132;01m{}[39;00m[38;5;124m'[39m[38;5;124m"[39m[38;5;241m.[39mformat(SIG_MAP[s]))
  [0;32m---> 42[0m     [43mos[49m[38;5;241;43m.[39;49m[43mkill[49m[43m([49m[43mos[49m[38;5;241;43m.[39;49m[43mgetpid[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43ms[49m[43m)[49m

  [0;31mKeyboardInterrupt[0m:
  [INFO    hops.core.integration     1570847] Choosing the nonlinear integrator.
  [INFO    root                      1570847] Starting analysis process.
  [INFO    root                      1570847] Started analysis process with pid 1591390.
  [INFO    hops.core.hierarchy_data  1570847] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_624d57566d8901608d64e1679da331daba8e879560df92da9b38b36470bdb719.fifo
  [INFO    hops.core.integration     1570847] Using 32 integrators.
  [INFO    hops.core.integration     1570847] Some 5000 trajectories have to be integrated.
  [INFO    hops.core.integration     1570847] Using 1820 hierarchy states.
 11% 530/5000 [10:07<1:25:24,  1.15s/it][INFO    hops.core.signal_delay    1570847] caught sig 'SIGINT'
  [INFO    hops.core.signal_delay    1570847] caught 1 signal(s)
  [INFO    hops.core.signal_delay    1570847] emit signal 'SIGINT'
  [INFO    hops.core.signal_delay    1570847] caught sig 'SIGINT'
 11% 530/5000 [10:08<1:25:31,  1.15s/it]
  2022-12-12 18:38:50,225       WARNING worker.py:1404 -- A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: b2e812ea065894d48757aee2829dd7b57b77d4871c000000 Worker ID: bcf1d2469b152acd74133ec1976b7646b149079955ee10d3335a8df5 Node ID: e07627c1480611828c4c69e3a9f3198eaba4819e531c859088c91737 Worker IP address: 10.0.0.10 Worker port: 10242 Worker PID: 197359
  2022-12-12 18:38:50,244       WARNING worker.py:1404 -- A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: a9e15e2f0cd954a4c2d67c75c5bc88a995a104ad1c000000 Worker ID: 015d3e521346c70a0da508b576f40564b642299dec2ecb54927d4abe Node ID: e07627c1480611828c4c69e3a9f3198eaba4819e531c859088c91737 Worker IP address: 10.0.0.10 Worker port: 10258 Worker PID: 197524
  2022-12-12 18:38:50,253       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,255       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,256       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,256       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  [INFO    hops.core.signal_delay    1570847] caught 1 signal(s)
  2022-12-12 18:38:50,257       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  [INFO    hops.core.signal_delay    1570847] emit signal 'SIGINT'
  2022-12-12 18:38:50,258       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,259       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  [INFO    hops.core.signal_delay    1570847] caught sig 'SIGINT'
  2022-12-12 18:38:50,260       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,260       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,261       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,261       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,262       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,263       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,263       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,264       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,264       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,265       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,266       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,266       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,267       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,268       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,268       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,268       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,269       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,270       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,270       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,271       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,272       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,272       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,273       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,274       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  2022-12-12 18:38:50,274       ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
  [INFO    hops.core.signal_delay    1570847] caught 1 signal(s)
  [INFO    hops.core.signal_delay    1570847] emit signal 'SIGINT'
#+end_example
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mKeyboardInterrupt[0m                         Traceback (most recent call last)
  Cell [0;32mIn[50], line 1[0m
  [0;32m----> 1[0m [43mot[49m[38;5;241;43m.[39;49m[43mintegrate_online[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[38;5;241;43m5000[39;49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:155[0m, in [0;36mintegrate_online[0;34m(model, n, stream_folder, **kwargs)[0m
  [1;32m    154[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online[39m(model, n, stream_folder[38;5;241m=[39m[38;5;28;01mNone[39;00m, [38;5;241m*[39m[38;5;241m*[39mkwargs):
  [0;32m--> 155[0m     [43maux[49m[38;5;241;43m.[39;49m[43mintegrate[49m[43m([49m
  [1;32m    156[0m [43m        [49m[43mmodel[49m[43m,[49m
  [1;32m    157[0m [43m        [49m[43mn[49m[43m,[49m
  [1;32m    158[0m [43m        [49m[43mstream_file[49m[38;5;241;43m=[39;49m[43m([49m[38;5;124;43m"[39;49m[38;5;124;43m"[39;49m[43m [49m[38;5;28;43;01mif[39;49;00m[43m [49m[43mstream_folder[49m[43m [49m[38;5;129;43;01mis[39;49;00m[43m [49m[38;5;28;43;01mNone[39;49;00m[43m [49m[38;5;28;43;01melse[39;49;00m[43m [49m[43mstream_folder[49m[43m)[49m
  [1;32m    159[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43mf[39;49m[38;5;124;43m"[39;49m[38;5;124;43mresults_[39;49m[38;5;132;43;01m{[39;49;00m[43mmodel[49m[38;5;241;43m.[39;49m[43mhexhash[49m[38;5;132;43;01m}[39;49;00m[38;5;124;43m.fifo[39;49m[38;5;124;43m"[39;49m[43m,[49m
  [1;32m    160[0m [43m        [49m[43manalyze[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m,[49m
  [1;32m    161[0m [43m        [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m,[49m
  [1;32m    162[0m [43m    [49m[43m)[49m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:201[0m, in [0;36mintegrate[0;34m(model, n, data_path, clear_pd, single_process, stream_file, analyze, results_path, analyze_kwargs)[0m
  [1;32m    199[0m         supervisor[38;5;241m.[39mintegrate_single_process(clear_pd)
  [1;32m    200[0m     [38;5;28;01melse[39;00m:
  [0;32m--> 201[0m         supervisor[38;5;241m.[39mintegrate(clear_pd)
  [1;32m    203[0m cleanup([38;5;241m0[39m)

  File [0;32m~/src/hops/hops/core/signal_delay.py:87[0m, in [0;36msig_delay.__exit__[0;34m(self, exc_type, exc_val, exc_tb)[0m
  [1;32m     84[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught) [38;5;241m>[39m [38;5;241m0[39m [38;5;129;01mand[39;00m [38;5;28mself[39m[38;5;241m.[39mhandler [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
  [1;32m     85[0m     [38;5;28mself[39m[38;5;241m.[39mhandler([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught)
  [0;32m---> 87[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43m_restore[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:68[0m, in [0;36msig_delay._restore[0;34m(self)[0m
  [1;32m     66[0m [38;5;28;01mfor[39;00m i, s [38;5;129;01min[39;00m [38;5;28menumerate[39m([38;5;28mself[39m[38;5;241m.[39msigs):
  [1;32m     67[0m     signal[38;5;241m.[39msignal(s, [38;5;28mself[39m[38;5;241m.[39mold_handlers[i])
  [0;32m---> 68[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43msigh[49m[38;5;241;43m.[39;49m[43memit[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:42[0m, in [0;36mSigHandler.emit[0;34m(self)[0m
  [1;32m     40[0m [38;5;28;01mfor[39;00m s [38;5;129;01min[39;00m [38;5;28mself[39m[38;5;241m.[39msigs_caught:
  [1;32m     41[0m     log[38;5;241m.[39minfo([38;5;124m"[39m[38;5;124memit signal [39m[38;5;124m'[39m[38;5;132;01m{}[39;00m[38;5;124m'[39m[38;5;124m"[39m[38;5;241m.[39mformat(SIG_MAP[s]))
  [0;32m---> 42[0m     [43mos[49m[38;5;241;43m.[39;49m[43mkill[49m[43m([49m[43mos[49m[38;5;241;43m.[39;49m[43mgetpid[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43ms[49m[43m)[49m

  [0;31mKeyboardInterrupt[0m:
#+end_example
:END:


** Results
:PROPERTIES:
:header-args:  :session baseline_noshift_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
  import otto_utilities as ot
  import plot_utils as pu
  from baseline_noshift import model, model_fft

  ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
[[file:./.ob-jupyter/4f57719ec56b5d4bcdc1e6c3e2884c37afb8eb35.svg]]
[[file:./.ob-jupyter/67ffcf01a06dcb88c0db99a3f8ae2bc06cda31b0.svg]]
:END:


#+begin_src jupyter-python
  f, a = plt.subplots()
  for bath in range(2):
      pu.plot_with_Ïƒ(model_fft.t, model_fft.bath_energy_flow().for_bath(bath), ax=a)
      pu.plot_with_Ïƒ(model.t, model.bath_energy_flow().for_bath(bath), ax=a)

#+end_src

#+RESULTS:
[[file:./.ob-jupyter/6f685aff0228e4808b573eb24237f728897c4bfb.svg]]


#+begin_src jupyter-python
  import numpy as np

  t = np.linspace(0, 1, 100)

  f, a = plt.subplots()

  for m in [model, model_fft]:
      total = np.zeros_like(t, dtype=complex)
      N = 10_000
      proc = m.thermal_process(1)
      proc.calc_deriv = True
      for _ in range(N):
          proc.new_process()
          total += proc.dot(t).conjugate() * proc(0)

      pu.plot_complex(t, total.conj() / N, ax=a)

  #pu.plot_complex(t, np.gradient(np.gradient(model.thermal_correlations(1)(t), t), t)/ 4, ax=a)
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/3d5ba68b7cd6f8a9ccd027aeebc434cb64bd1986.svg]]




* Tangent: FFT vs TanhSinh
:PROPERTIES:
:header-args: :tangle baseline_noshift.py :session baseline_noshift :noweb yes :async yes
:END:

A basic otto cycle that has a finite power output but without resonance.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  model = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[2, 2],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A basic near-markovian, weakly coupled Otto Cycle without the shift.",
      k_max=3,
      bcf_terms=[4] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-4, 1e-4)] * 2,
      T=[0, 2],
      therm_methods=["tanhsinh", "tanhsinh"],
      Î”=1,
      num_cycles=1,
      Î˜=1.5 / 0.05,
      dt=0.001,
      timings_H=(0, 0.1, 0.5, 0.6),
      timings_L=((0.6, 0.7, 0.9, 1), (0.1, 0.2, 0.4, 0.5)),
      streaming_mode=True,
      shift_to_resonance=(False, False),
      #Ï‰_s_extra=[.1, .1],
  )

  model_fft = model.copy()
  model_fft.therm_methods = ["fft", "fft"]

  ot.plot_cycle(model)
#+end_src
#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/5d0bad2e6ef80abb8d60c2cbff3786dd01ebf25e.svg]]
:END:


#+begin_src jupyter-python
  ot.plot_sd_overview(model)
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\omega$ | ylabel= | Spectral Density | > |
[[file:./.ob-jupyter/914137aa7a7a69ca970157064773bfe0d273e743.svg]]
:END:


#+begin_src jupyter-python :tangle no
  ot.integrate_online(model_fft, 5000)
  ot.integrate_online(model, 5000)
#+end_src

#+RESULTS:
#+begin_example
  [INFO    hops.core.integration     1570847] Choosing the nonlinear integrator.
  [INFO    root                      1570847] Starting analysis process.
  [INFO    root                      1570847] Started analysis process with pid 1576372.
  [INFO    hops.core.hierarchy_data  1570847] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_d3093039d2e9ab9d02aab76a07b979a7141942b32be1e00a2055e9308033416a.fifo
  [INFO    hops.core.integration     1570847] Using 32 integrators.
  [INFO    hops.core.integration     1570847] Some 3958 trajectories have to be integrated.
  [INFO    hops.core.integration     1570847] Using 165 hierarchy states.
  100% 3958/3958 [16:07<00:00,  4.09it/s]
  [INFO    hops.core.integration     1570847] Choosing the nonlinear integrator.
  [INFO    root                      1570847] Starting analysis process.
  [INFO    root                      1570847] Started analysis process with pid 1581080.
  [INFO    hops.core.hierarchy_data  1570847] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_dc05b28e7c3cc07088dd643d6d07bdeebe680b41c0cb58d7c9e0893d182e483a.fifo
  [INFO    hops.core.integration     1570847] Using 32 integrators.
  [INFO    hops.core.integration     1570847] Some 4000 trajectories have to be integrated.
  [INFO    hops.core.integration     1570847] Using 165 hierarchy states.
100% 4000/4000 [16:30<00:00,  4.04it/s]
#+end_example


** Results
:PROPERTIES:
:header-args:  :session baseline_noshift_res :noweb yes :async yes
:END:

#+begin_src jupyter-python
  import otto_utilities as ot
  import plot_utils as pu
  from baseline_noshift import model, model_fft

  ot.plot_energy(model)
#+end_src

#+RESULTS:
:RESULTS:
[[file:./.ob-jupyter/4f57719ec56b5d4bcdc1e6c3e2884c37afb8eb35.svg]]
[[file:./.ob-jupyter/67ffcf01a06dcb88c0db99a3f8ae2bc06cda31b0.svg]]
:END:


#+begin_src jupyter-python
  f, a = plt.subplots()
  for bath in range(2):
      pu.plot_with_Ïƒ(model_fft.t, model_fft.bath_energy_flow().for_bath(bath), ax=a)
      pu.plot_with_Ïƒ(model.t, model.bath_energy_flow().for_bath(bath), ax=a)

#+end_src

#+RESULTS:
[[file:./.ob-jupyter/6f685aff0228e4808b573eb24237f728897c4bfb.svg]]


#+begin_src jupyter-python
  import numpy as np

  t = np.linspace(0, 1, 100)

  f, a = plt.subplots()

  for m in [model, model_fft]:
      total = np.zeros_like(t, dtype=complex)
      N = 10_000
      proc = m.thermal_process(1)
      proc.calc_deriv = True
      for _ in range(N):
          proc.new_process()
          total += proc.dot(t).conjugate() * proc(0)

      pu.plot_complex(t, total.conj() / N, ax=a)

  #pu.plot_complex(t, np.gradient(np.gradient(model.thermal_correlations(1)(t), t), t)/ 4, ax=a)
#+end_src

#+RESULTS:
[[file:./.ob-jupyter/3d5ba68b7cd6f8a9ccd027aeebc434cb64bd1986.svg]]



* Scans
In this section we run some parameter scans on the otto cycle.

** Switching Speed
:PROPERTIES:
:header-args: :tangle speed_coupling_scan.py :session speed_coupling_scan :noweb yes :async yes
:END:
Inspired by cite:Wiedmann2020Mar, we will begin with a scan of coupling strength vs coupling switching speed.

*** Model
A basic otto cycle that has a finite power output but without resonance.

#+begin_src jupyter-python
  <<boilerplate>>
#+end_src

#+RESULTS:

#+begin_src jupyter-python
  def timings(Ï„_c, Ï„_i):
      Ï„_th = (1 - 2 * Ï„_c) / 2
      Ï„_i_on = (Ï„_th - 2*Ï„_i)
      timings_H = (0, Ï„_c, Ï„_c + Ï„_th, 2*Ï„_c + Ï„_th)
      timings_L_hot = (Ï„_c, Ï„_c + Ï„_i, Ï„_c + Ï„_i + Ï„_i_on, Ï„_c + 2 * Ï„_i + Ï„_i_on)

      timings_L_cold = tuple(time + timings_H[2] for time in timings_L_hot)

      return timings_H, (timings_L_cold, timings_L_hot)
#+end_src

#+RESULTS:


- no shift, to keep things simple

#+begin_src jupyter-python
  (p_H, p_L) = timings(0.1, 0.3)
  prototype = OttoEngine(
      Î´=[0.4, 0.4],
      Ï‰_c=[2, 2],
      Ïˆ_0=qt.basis([2], [1]),
      description=f"A model for scanning coupling strength and interactin switch times.",
      k_max=4,
      bcf_terms=[6] * 2,
      truncation_scheme="simplex",
      driving_process_tolerances=[StocProcTolerances(1e-3, 1e-3)] * 2,
      thermal_process_tolerances=[StocProcTolerances(1e-3, 1e-3)] * 2,
      T=[1, 10],
      therm_methods=["tanhsinh", "tanhsinh"],
      Î”=1,
      num_cycles=4,
      Î˜=1.5 / 0.05,
      dt=0.01,
      timings_H=p_H,
      timings_L=p_L,
      streaming_mode=True,
      shift_to_resonance=(False, False),
  )

#+end_src

#+RESULTS:

*** Scan Definition
As hamiltonian switching is not very interesting per-se, as it is
diagonal and directly translates into addional power vs longer
coupling we change the switching speed of the interaction and the coupling strength.


#+begin_src jupyter-python
  Î´s = np.round(np.linspace(.1, 1, 5), 3)
  Ï„_Is = np.round(np.linspace(.01, .3, 5), 3)
  Ï„_Is
#+end_src

#+RESULTS:
: array([0.01 , 0.082, 0.155, 0.227, 0.3  ])

#+begin_src jupyter-python
  models = []

  import itertools

  for Ï„_I, Î´ in itertools.product(Ï„_Is, Î´s):
      (p_H, p_L) = timings(0.1, Ï„_I)

      model = prototype.copy()
      model.Î´ = [Î´, Î´]
      model.timings_H = p_H
      model.timings_L = p_L
      models.append(model)


  ot.plot_cycles(models[:: len(Î´s)])
#+end_src

#+RESULTS:
:RESULTS:
| <Figure | size | 1200x400 | with | 1 | Axes> | <AxesSubplot: | xlabel= | $\tau$ | ylabel= | Operator Norm | > |
[[file:./.ob-jupyter/b8a87003ac33e1b1bd5e51db2b0e26ac18ef52eb.svg]]
:END:

*** Integration
:PROPERTIES:
:header-args: :tangle speed_coupling_integration.py :session speed_coupling_integration :noweb yes :async yes
:END:

#+begin_src jupyter-python
  from speed_coupling_scan import *

  ot.integrate_online_multi(models, 1000)
#+end_src

#+RESULTS:
:RESULTS:
#+begin_example
   [INFO    hops.core.integration     15571] Choosing the nonlinear integrator.
   [INFO    root                      15571] Starting analysis process.
   [INFO    root                      15571] Started analysis process with pid 24455.
   [INFO    hops.core.hierarchy_data  15571] Creating the streaming fifo at: /home/hiro/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/results_9a1fcaa6e61c32845fb024d60f2ab5d4db6ed145604b6beb18a1318288c05fa3.fifo
   [INFO    hops.core.integration     15571] Using 16 integrators.
   [INFO    hops.core.integration     15571] Some 1000 trajectories have to be integrated.
   [INFO    hops.core.integration     15571] Using 455 hierarchy states.
    27% 273/1000 [16:41<44:26,  3.67s/it][INFO    hops.core.signal_delay    15571] caught sig 'SIGINT'
   [INFO    hops.core.signal_delay    15571] caught 1 signal(s)
   [INFO    hops.core.signal_delay    15571] emit signal 'SIGINT'
   [INFO    hops.core.signal_delay    15571] caught sig 'SIGINT'
  27% 274/1000 [16:51<44:39,  3.69s/it]
   2022-12-09 12:30:00,217      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,221      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,222      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,223      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   [INFO    hops.core.signal_delay    15571] caught 1 signal(s)
   2022-12-09 12:30:00,225      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   [INFO    hops.core.signal_delay    15571] emit signal 'SIGINT'
   2022-12-09 12:30:00,226      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   [INFO    hops.core.signal_delay    15571] caught sig 'SIGINT'
   2022-12-09 12:30:00,230      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,231      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,239      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,240      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,242      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,243      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,245      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,246      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,247      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,248      ERROR worker.py:94 -- Unhandled error (suppress with 'RAY_IGNORE_UNHANDLED_ERRORS=1'): The worker died unexpectedly while executing this task. Check python-core-worker-*.log files for more information.
   2022-12-09 12:30:00,256      WARNING worker.py:1404 -- A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: 4aad93ca0144cfd466f7c538c1f973bce532a5b001000000 Worker ID: 6614947cc8aa9bee091895343da3721bdd280daba735cf241411846f Node ID: 9c47dfc4d392dd3e27cbaf9b61a64c51c008187c958d91f7405f9a90 Worker IP address: 10.0.0.102 Worker port: 34075 Worker PID: 23600
   2022-12-09 12:30:00,257      WARNING worker.py:1404 -- A worker died or was killed while executing a task by an unexpected system error. To troubleshoot the problem, check the logs for the dead worker. RayTask ID: 4685e2bbb803928ba5d3d2526dc35f643ffe982101000000 Worker ID: 2dd3f41be7b13460bb7a25cd2108f3a8307d5e1ec1bf32336cbe0e0f Node ID: 9c47dfc4d392dd3e27cbaf9b61a64c51c008187c958d91f7405f9a90 Worker IP address: 10.0.0.102 Worker port: 44333 Worker PID: 23601
   [INFO    hops.core.signal_delay    15571] caught 1 signal(s)
   [INFO    hops.core.signal_delay    15571] emit signal 'SIGINT'
#+end_example
# [goto error]
#+begin_example
  [0;31m---------------------------------------------------------------------------[0m
  [0;31mKeyboardInterrupt[0m                         Traceback (most recent call last)
  Cell [0;32mIn[2], line 3[0m
  [1;32m      1[0m [38;5;28;01mfrom[39;00m [38;5;21;01mspeed_coupling_scan[39;00m [38;5;28;01mimport[39;00m [38;5;241m*[39m
  [0;32m----> 3[0m [43mot[49m[38;5;241;43m.[39;49m[43mintegrate_online_multi[49m[43m([49m[43mmodels[49m[43m,[49m[43m [49m[38;5;241;43m1000[39;49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:166[0m, in [0;36mintegrate_online_multi[0;34m(models, *args, **kwargs)[0m
  [1;32m    164[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online_multi[39m(models, [38;5;241m*[39margs, [38;5;241m*[39m[38;5;241m*[39mkwargs):
  [1;32m    165[0m     [38;5;28;01mfor[39;00m model [38;5;129;01min[39;00m models:
  [0;32m--> 166[0m         [43mintegrate_online[49m[43m([49m[43mmodel[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[43margs[49m[43m,[49m[43m [49m[38;5;241;43m*[39;49m[38;5;241;43m*[39;49m[43mkwargs[49m[43m)[49m

  File [0;32m~/Documents/Projects/UNI/master/eflow_paper/python/otto_motor/otto_utilities.py:155[0m, in [0;36mintegrate_online[0;34m(model, n, stream_folder)[0m
  [1;32m    154[0m [38;5;28;01mdef[39;00m [38;5;21mintegrate_online[39m(model, n, stream_folder[38;5;241m=[39m[38;5;28;01mNone[39;00m):
  [0;32m--> 155[0m     [43maux[49m[38;5;241;43m.[39;49m[43mintegrate[49m[43m([49m
  [1;32m    156[0m [43m        [49m[43mmodel[49m[43m,[49m
  [1;32m    157[0m [43m        [49m[43mn[49m[43m,[49m
  [1;32m    158[0m [43m        [49m[43mstream_file[49m[38;5;241;43m=[39;49m[43m([49m[38;5;124;43m"[39;49m[38;5;124;43m"[39;49m[43m [49m[38;5;28;43;01mif[39;49;00m[43m [49m[43mstream_folder[49m[43m [49m[38;5;129;43;01mis[39;49;00m[43m [49m[38;5;28;43;01mNone[39;49;00m[43m [49m[38;5;28;43;01melse[39;49;00m[43m [49m[43mstream_folder[49m[43m)[49m
  [1;32m    159[0m [43m        [49m[38;5;241;43m+[39;49m[43m [49m[38;5;124;43mf[39;49m[38;5;124;43m"[39;49m[38;5;124;43mresults_[39;49m[38;5;132;43;01m{[39;49;00m[43mmodel[49m[38;5;241;43m.[39;49m[43mhexhash[49m[38;5;132;43;01m}[39;49;00m[38;5;124;43m.fifo[39;49m[38;5;124;43m"[39;49m[43m,[49m
  [1;32m    160[0m [43m        [49m[43manalyze[49m[38;5;241;43m=[39;49m[38;5;28;43;01mTrue[39;49;00m[43m,[49m
  [1;32m    161[0m [43m    [49m[43m)[49m

  File [0;32m~/src/two_qubit_model/hiro_models/model_auxiliary.py:200[0m, in [0;36mintegrate[0;34m(model, n, data_path, clear_pd, single_process, stream_file, analyze, results_path, analyze_kwargs)[0m
  [1;32m    198[0m         supervisor[38;5;241m.[39mintegrate_single_process(clear_pd)
  [1;32m    199[0m     [38;5;28;01melse[39;00m:
  [0;32m--> 200[0m         supervisor[38;5;241m.[39mintegrate(clear_pd)
  [1;32m    202[0m cleanup([38;5;241m0[39m)

  File [0;32m~/src/hops/hops/core/signal_delay.py:87[0m, in [0;36msig_delay.__exit__[0;34m(self, exc_type, exc_val, exc_tb)[0m
  [1;32m     84[0m [38;5;28;01mif[39;00m [38;5;28mlen[39m([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught) [38;5;241m>[39m [38;5;241m0[39m [38;5;129;01mand[39;00m [38;5;28mself[39m[38;5;241m.[39mhandler [38;5;129;01mis[39;00m [38;5;129;01mnot[39;00m [38;5;28;01mNone[39;00m:
  [1;32m     85[0m     [38;5;28mself[39m[38;5;241m.[39mhandler([38;5;28mself[39m[38;5;241m.[39msigh[38;5;241m.[39msigs_caught)
  [0;32m---> 87[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43m_restore[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:68[0m, in [0;36msig_delay._restore[0;34m(self)[0m
  [1;32m     66[0m [38;5;28;01mfor[39;00m i, s [38;5;129;01min[39;00m [38;5;28menumerate[39m([38;5;28mself[39m[38;5;241m.[39msigs):
  [1;32m     67[0m     signal[38;5;241m.[39msignal(s, [38;5;28mself[39m[38;5;241m.[39mold_handlers[i])
  [0;32m---> 68[0m [38;5;28;43mself[39;49m[38;5;241;43m.[39;49m[43msigh[49m[38;5;241;43m.[39;49m[43memit[49m[43m([49m[43m)[49m

  File [0;32m~/src/hops/hops/core/signal_delay.py:42[0m, in [0;36mSigHandler.emit[0;34m(self)[0m
  [1;32m     40[0m [38;5;28;01mfor[39;00m s [38;5;129;01min[39;00m [38;5;28mself[39m[38;5;241m.[39msigs_caught:
  [1;32m     41[0m     log[38;5;241m.[39minfo([38;5;124m"[39m[38;5;124memit signal [39m[38;5;124m'[39m[38;5;132;01m{}[39;00m[38;5;124m'[39m[38;5;124m"[39m[38;5;241m.[39mformat(SIG_MAP[s]))
  [0;32m---> 42[0m     [43mos[49m[38;5;241;43m.[39;49m[43mkill[49m[43m([49m[43mos[49m[38;5;241;43m.[39;49m[43mgetpid[49m[43m([49m[43m)[49m[43m,[49m[43m [49m[43ms[49m[43m)[49m

  [0;31mKeyboardInterrupt[0m:
#+end_example
[[file:./.ob-jupyter/3855db61f0f4ad19d82995c1192d5cfeb54a12df.svg]]
:END:

*** Analysis
:PROPERTIES:
:header-args: :tangle no :session speed_coupling_analysis :noweb yes :async yes
:END:

#+begin_src jupyter-python
  from speed_coupling_scan import *
#+end_src

#+RESULTS:

**** Import from taurus
#+begin_src bash :results none
  umount taurus
  sshfs s4498638@taurusexport.hrsk.tu-dresden.de:/beegfs/ws/0/s4498638-paper_otto/project/python/otto_motor/ taurus
#+end_src

#+begin_src jupyter-python
  taurus_path = "taurus"
  from hiro_models.model_auxiliary import import_results
  import_results(other_data_path="./taurus/.data", other_results_path="./taurus/results", interactive=False, models_to_import=models)
#+end_src

**** Plots
#+begin_src jupyter-python
  f, a = plt.subplots()

  for model in models:
      try:
          pu.plot_with_Ïƒ(model.t, model.bath_energy_flow().sum_baths(), ax=a, label=fr"$\delta={model.Î´[0]}$, $\tau_I={model.timings_L[0][1] - model.timings_L[0][0]:.3}$")
      except:
          pass
  a.legend()
#+end_src

#+RESULTS:
:RESULTS:
: <matplotlib.legend.Legend at 0x7f6613da0df0>
[[file:./.ob-jupyter/5598f711c42dae4d208692e09c8d7c4d187df7af.svg]]
:END:

#+begin_src jupyter-python
  ot.plot_energy(model[4])
#+end_src


#+begin_src jupyter-python
  %matplotlib tk
  import random
  powers = []
  for model in models:
      try:
          powers.append(-model.power(Ïƒ_factor=2).value)
      except:
          powers.append(0)
  #powers = np.array([model.power().value for model in models])
  #powers = np.array([random.random() for model in models])
  print(powers)
  powers = np.nan_to_num(np.array(powers))
  normalized_powers = powers - powers.min()
  normalized_powers /= normalized_powers.max()
  Blues = plt.get_cmap("plasma")
  colors = [Blues(power) for power in normalized_powers]
  ax1 = plt.gcf().add_subplot(111, projection='3d')

  _xx, _yy = np.meshgrid(Î´s, Ï„_Is)
  x, y = _xx.ravel(), _yy.ravel()
  dx = (Î´s[1] - Î´s[0])
  dy = (Ï„_Is[1] - Ï„_Is[0])
  x -= dx /2
  y -= dy /2
  ax1.bar3d(x, y, np.zeros_like(powers), dx, dy, powers, color=colors)
  ax1.set_xticks(Î´s)
  ax1.set_yticks(Ï„_Is)

  ax1.set_xlabel(r"$\delta$")
  ax1.set_ylabel(r"$\tau_I$")
  ax1.set_zlabel(r"$P$")
#+end_src

#+RESULTS:
:RESULTS:
: [0.002134106950987974, 0.004447652344254545, 0.005336811752206002, 0.005642287221458076, 0.005346095175226326, 0.0008279062113372872, 0.002405069527323568, 0.0021224587178385974, 0.0013412445507945132, 3.378982276424556e-05, 0.0010426976560339602, 0.0028470757311842526, 0.003319440269079654, 0, 0.0034347499850480834, 0, 0.0016061846860634756, 0.0026573662669084263, 0.0034151114387306536, 0.0035394330535580268, 0, 0, 0.0011660306058975797, 0.0013905235924367885, 0.0016303106751158706]
: Text(0.5, 0, '$P$')
:END:


#+begin_src jupyter-python
  %matplotlib inline
  model = models[19]
  f, a, _ = pu.plot_with_Ïƒ(model.t, model.total_power(), label=fr"$\delta={model.Î´[0]}$, $\tau_I={model.timings_L[0][1] - model.timings_L[0][0]:.3}$")
  model = models[19-5]
  pu.plot_with_Ïƒ(model.t, model.total_power(), ax=a, label=fr"$\delta={model.Î´[0]}$, $\tau_I={model.timings_L[0][1] - model.timings_L[0][0]:.3}$")
  a.legend()
#+end_src

#+RESULTS:
:RESULTS:
: <matplotlib.legend.Legend at 0x7f660d98e3d0>
[[file:./.ob-jupyter/c5f9d68e31536193ca5dfe55e580f26382015322.svg]]
:END:

** Coupling and System Switching overlap
Let's see if it helps switching system and interaction at the same time.
